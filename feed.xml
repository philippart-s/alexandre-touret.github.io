<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.2">Jekyll</generator><link href="https://blog.touret.info/feed.xml" rel="self" type="application/atom+xml" /><link href="https://blog.touret.info/" rel="alternate" type="text/html" /><updated>2022-06-12T16:28:11+00:00</updated><id>https://blog.touret.info/feed.xml</id><title type="html">blog.touret.info</title><subtitle>Mon blog personnel. J'y expose mes derniers travaux et ma veille technologique. Au menu en vrac: Java, Kotlin, Maven, Docker, Cloud, Kubernetes, logiciels libres, Debian, Ubuntu, Gnu/Linux, des talks online et pr√©sentiels.</subtitle><author><name>Alexandre Touret</name></author><entry><title type="html">Mon Camping des Speakers</title><link href="https://blog.touret.info/2022/06/10/camping-speakers-2022/" rel="alternate" type="text/html" title="Mon Camping des Speakers" /><published>2022-06-10T08:00:00+00:00</published><updated>2022-06-10T08:00:00+00:00</updated><id>https://blog.touret.info/2022/06/10/camping-speakers-2022</id><content type="html" xml:base="https://blog.touret.info/2022/06/10/camping-speakers-2022/">&lt;p&gt;Au d√©but de l‚Äôann√©e, j‚Äôai interpel√© mes managers: &lt;em&gt;‚ÄúJ‚Äôai √©t√© retenu au &lt;a href=&quot;https://camping-speakers.fr/&quot;&gt;Camping des Speakers‚Äù&lt;/a&gt;!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Unanimement, j‚Äôai eu la m√™me r√©ponse: &lt;em&gt;‚ÄúLe QUOI ???!!!‚Äù&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Oui j‚Äôen conviens le titre peut para√Ætre √† premi√®re vue tout sauf s√©rieux. 
Il faut dire que le lieu est un camping en Bretagne dans le golfe du Morbihan.&lt;/p&gt;

&lt;p&gt;Et pourtant‚ÄØ!&lt;/p&gt;

&lt;p&gt;La programmation √©tait de qualit√© et a tenu ses promesses.&lt;/p&gt;

&lt;p&gt;Je vais essayer de retranscrire quelques sujets qui ont retenu mon attention. J‚Äôen oublierai sans doute beaucoup. Je m‚Äôen excuse d‚Äôavance.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/06/camping_speakers_2.webp&quot; alt=&quot;bollinette&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Tout d‚Äôabord, l‚Äôint√©r√™t de cette conf√©rence r√©side, selon moi, au-del√† des talks donn√©s.&lt;/p&gt;

&lt;p&gt;Le cadre atypique (un camping dans le Morbihan), des conf√©rences &lt;em&gt;slideless&lt;/em&gt; donn√©es en ext√©rieur en mode ‚Äúfeu de camp‚Äù a eu le m√™me effet, enfin il me semble, sur tous les participantes et participants qu‚Äôils soient speakers ou non.&lt;/p&gt;

&lt;p&gt;Chose originale que j‚Äôai pu constater lors de ces talks, on passait beaucoup de temps √† √©changer avec les speakers &lt;strong&gt;pendant&lt;/strong&gt; leur pr√©sentation. 
C‚Äô√©tait g√©nial pour les spectateurs, peut-√™tre un peu moins pour la gestion du timing :).&lt;/p&gt;

&lt;p&gt;Vous l‚Äôaurez compris. L‚Äôenvironnement mis en place par les organisateurs permettait de r√©els √©changes‚Ä¶ Et on avait le temps de le faire.&lt;/p&gt;

&lt;p&gt;Ensuite, la programmation donnait la part belle √† des sujets non techniques.&lt;/p&gt;

&lt;p&gt;Par exemple, j‚Äôai enfin pu voir la conf√©rence de mon ancienne coll√®gue &lt;a href=&quot;https://camping-speakers.fr/sessions/rendez_lagilite_aux_developpeurs/&quot;&gt;Fanny Klauk : ‚ÄúRendez l‚Äôagilit√© aux d√©veloppeur(se)s !‚Äù&lt;/a&gt; qui, au travers d‚Äôune histoire dont est le h√©ros, a mis en √©vidence les travers des (grosses) organisations. Les solutions sont &lt;em&gt;‚Äúnaturelles‚Äù&lt;/em&gt; dans la th√©orie, mais permettent de donner plus d‚Äôagilit√© et de sens aux d√©veloppeurs.&lt;/p&gt;

&lt;p&gt;Un autre sujet ‚Äúnon technique‚Äù m‚Äôa tr√®s int√©ress√©, c‚Äô√©tait &lt;a href=&quot;https://camping-speakers.fr/sessions/le_voyage_du_heros/&quot;&gt;‚ÄúLe voyage du h√©ros de l‚ÄôIT‚Äù d‚Äô Olivier Beautier&lt;/a&gt;. 
Apr√®s nous avoir pr√©sent√© &lt;a href=&quot;https://archive.org/details/leguideduscenari0000vogl&quot;&gt;le guide du sc√©nariste de C. VOGLER&lt;/a&gt;, on a construit une histoire d‚Äôune d√©veloppeuse.
Au travers de cette histoire, on a pu voir entre autres l‚Äôimportance du mentorat dans notre m√©tier.&lt;/p&gt;

&lt;p&gt;Puis, j‚Äôai vu la conf√©rence &lt;a href=&quot;https://camping-speakers.fr/sessions/java_a_la_vitesse_de_la_lumiere_grace_au_graal/&quot;&gt;d‚ÄôA. PENA ‚ÄúJava √† la vitesse de la lumi√®re gr√¢ce au Graal !‚Äù&lt;/a&gt;. 
Il a pr√©sent√© GraalVM, une comparaison avec HotSpot et les perspectives d‚Äô√©volution de cette JVM. Nul doute que le mode natif sera de plus en plus utilis√© dans les prochaines ann√©es.&lt;/p&gt;

&lt;p&gt;Ensuite, avec &lt;a href=&quot;https://davidaparicio.github.io/website/fr/event/&quot;&gt;D. APARICIO&lt;/a&gt;, nous avons pu voir les travers d‚Äôune (mauvaise) mod√©lisation de donn√©es au travers de son retour d‚Äôexp√©rience &lt;a href=&quot;https://camping-speakers.fr/sessions/au_secours_jai_un_homonyme/&quot;&gt;‚ÄúAu secours üò®! J‚Äôai un homonyme !! ‚Äú&lt;/a&gt;
Il a illustr√© l‚Äôimportance de bien mod√©liser pour ne pas avoir que le nom et pr√©nom comme identifiants dans un syst√®me par ex. ainsi que les impacts dans la vie courante.&lt;/p&gt;

&lt;p&gt;Vous l‚Äôaurez compris, il y avait beaucoup de conf√©rences int√©ressantes qui donnaient lieu √† des discussions tout aussi passionnantes.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Last but not least&lt;/em&gt;, j‚Äôai eu la chance de pr√©senter les katas d‚Äôarchitecture, comment les mettre en ≈ìuvre et quels sont les b√©n√©fices qu‚Äôon peut en tirer.
Je tiens √† remercier &lt;a href=&quot;https://julientopcu.com/&quot;&gt;Julien TOPCU&lt;/a&gt; et &lt;a href=&quot;https://craftsrecords.org/&quot;&gt;Craft Records&lt;/a&gt; pour l‚Äôaccompagnement dans la pr√©paration.&lt;/p&gt;

&lt;p&gt;Vous pourrez trouver les slides sur &lt;a href=&quot;https://speakerdeck.com/alexandretouret/ameliorer-les-competences-et-les-infrastructures-avec-les-katas-darchitecture-cc629dfb-87f6-4033-aabd-472472ae5655&quot;&gt;ma page speackerdeck&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pour finir, je conseille cette exp√©rience √† toutes les personnes qui veulent apprendre, √©changer dans un environnement convivial et zen.&lt;/p&gt;

&lt;p&gt;Si vous n‚Äô√™tes toujours pas convaincu, sachez qu‚Äôil y a √©galement des mashmallows.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Avec cet argument massue, on devrait convaincre les plus sceptiques! ;)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/06/camping_speakers_1.webp&quot; alt=&quot;mashmallow&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Merci encore aux organisatrices et organisateurs pour ces deux jours.&lt;/p&gt;

&lt;p&gt;√Ä l‚Äôann√©e prochaine !!&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="conference" /><summary type="html">Au d√©but de l‚Äôann√©e, j‚Äôai interpel√© mes managers: ‚ÄúJ‚Äôai √©t√© retenu au Camping des Speakers‚Äù!</summary></entry><entry><title type="html">Faire des batchs ‚ÄúCloud Native‚Äù dans Kubernetes</title><link href="https://blog.touret.info/2022/05/17/cloud-native-batchs/" rel="alternate" type="text/html" title="Faire des batchs ‚ÄúCloud Native‚Äù dans Kubernetes" /><published>2022-05-17T08:00:00+00:00</published><updated>2022-05-17T08:00:00+00:00</updated><id>https://blog.touret.info/2022/05/17/cloud-native-batchs</id><content type="html" xml:base="https://blog.touret.info/2022/05/17/cloud-native-batchs/">&lt;p&gt;Quand on parle du Cloud et de Kubernetes, g√©n√©ralement on pense aux APIs.
Mais qu‚Äôen est-il des batchs?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/05/pat-whelen-xSsWBa4rb6E-unsplash.webp&quot; alt=&quot;pat-whelen-xSsWBa4rb6E-unsplash.jpg &quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Oui, depuis plusieurs ann√©es, on pensait les √©radiquer, mais ils sont encore l√† et on en a encore besoin pour quelques ann√©es encore. 
Ils ont m√™me eu une deuxi√®me jeunesse avec le Big Data et l‚Äôexplosion des volum√©tries dans l‚ÄôIT.&lt;/p&gt;

&lt;p&gt;Je vais essayer de faire un tour d‚Äôhorizon dans cet article des batchs dans un environnement Cloud et plus particuli√®rement dans Kubernetes.&lt;/p&gt;

&lt;p&gt;Les exemples pr√©sent√©s dans cet article seront (sans doute) approfondis dans un second article et d‚Äôores et d√©j√† disponibles dans &lt;a href=&quot;https://github.com/alexandre-touret/k8s-batch&quot;&gt;mon GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-des-batchs-dans-le-cloud&quot;&gt;Pourquoi des batchs dans le Cloud?&lt;/h2&gt;

&lt;p&gt;A ce titre un peu provocateur, j‚Äôajouterais aussi &lt;em&gt;‚ÄúPourquoi des batchs dans Kubernetes ?‚Äù&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Oui, aujourd‚Äôhui encore,comme j‚Äôai pu l‚Äôindiquer pr√©c√©demment, on doit cr√©er des traitements batchs. A cot√© des APIs qui repr√©sentent le cas d‚Äôutilisation ‚Äústandard‚Äù du Cloud, on peut √©galement avoir √† traiter des fichiers volumineux allant de plusieurs centaines de Mo √† quelques Go.&lt;/p&gt;

&lt;p&gt;Parmi les cas d‚Äôutilisation qui n√©cessitent ce genre de traitement, on pourra avoir:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Les reprises de donn√©es (suite √† des erreurs ou lors d‚Äôune initialisation)&lt;/li&gt;
  &lt;li&gt;Traitement suite √† une r√©ception de fichiers (par ex. traitement de fichiers OPENDATA)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si vous √™tes d√©j√† pass√© sur le Cloud pour vos applications transactionnelles, vous vous poserez cette question: &lt;em&gt;Puis-je √©galement d√©ployer des batchs?&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;pourquoi-se-poser-cette-question&quot;&gt;Pourquoi se poser cette question?&lt;/h3&gt;

&lt;p&gt;Les r√©ponses sont multiples. 
Elles sont tout d‚Äôabord li√©es √† une rationalisation des environnements.
Vous avez votre application dans le cloud, votre base de donn√©es y est √©galement g√©r√©e pour √©viter la latence r√©seau.
Vous devez donc d√©ployer des traitements tiers au plus proche de celle-ci pour vous soustraire des m√™mes soucis.&lt;/p&gt;

&lt;p&gt;De plus, l‚Äô√©cosyst√®me li√© au cloud offre des technologies et pratiques qui rendent la vie plus simple (si, si, je vous assure) aux d√©veloppeurs et ops. 
Le d√©ploiement via &lt;a href=&quot;https://en.wikipedia.org/wiki/Infrastructure_as_code&quot;&gt;l‚ÄôInfra As Code&lt;/a&gt; est un bon exemple : Avoir toute l‚Äôinfrastructure li√©e aux traitements batchs et transactionnels versionn√©es et instantiables √† la demande est quelque chose dont on a du mal √† se passer!&lt;/p&gt;

&lt;h2 id=&quot;difficult√©s-par-rapport-aux-apis&quot;&gt;Difficult√©(s) par rapport aux APIs&lt;/h2&gt;

&lt;p&gt;Quand on d√©ploie une API dans le cloud, g√©n√©ralement tout va bien. 
On peut voir rapidement que cet environnement convient bien √† ce genre de traitements.&lt;/p&gt;

&lt;p&gt;Pour les batchs, c‚Äôest une autre affaire!
Selon les soci√©t√©s, il peut y avoir un fort historique et beaucoup plus d‚Äôexigences que pour les APIs. 
Ces derni√®res pourront √™tre li√©es aux performances, √† la qualit√© de service ou plus simplement √† l‚Äôutilisation.&lt;/p&gt;

&lt;p&gt;Il faut donc, √† l‚Äôinstar de toute architecture, d√©terminer quel sera l‚Äôenvironnement technique de ce type de traitement. 
Cette fois, on aura √† concilier performances, fichiers volumineux et reprises sur erreur.&lt;/p&gt;

&lt;h3 id=&quot;quelques-technologies&quot;&gt;Quelques technologies&lt;/h3&gt;

&lt;p&gt;On pourra retrouver dans notre future architecture les briques suivantes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Une passerelle de fichiers (File Gateway) pour permettre l‚Äôenvoi des fichiers de mani√®re s√©curis√©e&lt;/li&gt;
  &lt;li&gt;Un stockage objet pour la distribution de fichiers ou l‚Äôarchivage.&lt;/li&gt;
  &lt;li&gt;Les √©l√©ments n√©cessaires √† l‚ÄôAPI : bases de donn√©es, &lt;a href=&quot;https://en.wikipedia.org/wiki/Hardware_security_module&quot;&gt;HSMs&lt;/a&gt;, Cluster Kubernetes,‚Ä¶&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;modes-de-d√©clenchement&quot;&gt;Modes de d√©clenchement&lt;/h2&gt;

&lt;p&gt;Si on regarde de plus pr√®s les exigences techniques li√©es aux cas d‚Äôutilisation, on pourrait r√©sumer les diff√©rents modes de d√©clenchement de la mani√®re suivante:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Traitement sur r√©ception de fichiers&lt;/li&gt;
  &lt;li&gt;Traitement d√©clench√© par un ordonnanceur/orchestrateur centralis√© (ex. https://dkron.io/) de mani√®re r√©guli√®re ou non.&lt;/li&gt;
  &lt;li&gt;Traitement d√©clench√© par &lt;a href=&quot;https://en.wikipedia.org/wiki/Cron&quot;&gt;CRON&lt;/a&gt; (qui est un ordonnanceur, mais un peu plus roots)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;J‚Äôai volontairement exclu les traitements sur pr√©sence de messages (ex. Kafka). Je les consid√®re plus li√©s au monde transactionnel.&lt;/p&gt;

&lt;p&gt;Dans les paragraphes suivants, je vais d√©crire des solutions d‚Äôarchitecture qui permettent de d√©ployer ces traitements dans Kubernetes. J‚Äôaborderai sans doute un exemple dans un autre article&lt;/p&gt;

&lt;h2 id=&quot;contraintes&quot;&gt;Contraintes&lt;/h2&gt;

&lt;p&gt;D√®s qu‚Äôon s‚Äôaventure dans ce type de conception, nous aurons, au-del√† des &lt;a href=&quot;https://12factor.net/&quot;&gt;12 factors&lt;/a&gt;, les contraintes suivantes √† traiter:&lt;/p&gt;

&lt;h3 id=&quot;gestion-des-erreurs-et-indisponibilit√©s&quot;&gt;Gestion des erreurs et indisponibilit√©s&lt;/h3&gt;
&lt;p&gt;Dans un cluster Kubernetes, le crash d‚Äôun POD n‚Äôest pas r√©dhibitoire.
Le cluster permet de red√©marrer imm√©diatement une autre instance.&lt;/p&gt;

&lt;p&gt;Pour les APIs, ce n‚Äôest pas un probl√®me.
Pour les batchs, c‚Äôest une autre paire de manches. 
Quid du crash en plein milieu du traitement d‚Äôun fichier?&lt;/p&gt;

&lt;p&gt;Il faut donc penser √† ce cas (et √† d‚Äôautres) et archiver les fichiers pour un √©ventuel rejeu.&lt;/p&gt;

&lt;h3 id=&quot;donn√©es-et-idempotence-des-traitements&quot;&gt;Donn√©es et idempotence des traitements&lt;/h3&gt;

&lt;p&gt;Id√©alement, les fichiers doivent avoir des lignes ind√©pendantes qui peuvent √™tre ins√©r√©es individuellement et dans n‚Äôimporte quel ordre.
Aussi, chaque modification et traitement de donn√©es doivent √™tre idempotentes.&lt;/p&gt;

&lt;p&gt;Pourquoi? Pas seulement par ce que c‚Äôest sympa et l‚Äô√©tat de l‚Äôart, mais dans ce nouvel environnement, vous ne pourrez pas forc√©ment garantir l‚Äôordre des traitements.
L‚Äôune des solutions potentielles de traitement est de d√©coupler la lecture et l‚Äôinsertion par du queueing (Artemis, Kafka &lt;em&gt;- oui ce n‚Äôest pas du queuing, mais vous avez compris‚Ä¶&lt;/em&gt;). 
Dans ce cas, si votre traitement n‚Äôest pas idempotent, vous devrez lutter avec des doublons en base.&lt;/p&gt;

&lt;h3 id=&quot;gestion-des-ressources&quot;&gt;Gestion des ressources&lt;/h3&gt;

&lt;p&gt;Imaginez, vous recevez un fichier de 1Go. 
Vos ressources syst√®mes sont des PODs avec un 1 Go de RAM.&lt;/p&gt;

&lt;p&gt;Vous voyez le soucis?&lt;/p&gt;

&lt;p&gt;Cet exemple, qui n‚Äôest pas trop √©loign√© de la r√©alit√©, mets en √©vidence l‚Äôune des contraintes techniques que vous devrez prendre d√®s le d√©but de votre conception.&lt;/p&gt;

&lt;p&gt;L‚Äôune des solutions serait, par exemple, le traitement quasi syst√©matique du streaming de fichiers et l‚Äôobligation d‚Äôavoir des fichiers avec des lignes de donn√©es ind√©pendantes (c.-√†-d. sans avoir √† faire de liens inter lignes pendant le traitement).&lt;/p&gt;

&lt;h2 id=&quot;traitement-sur-r√©ception-de-fichiers&quot;&gt;Traitement sur r√©ception de fichiers&lt;/h2&gt;

&lt;p&gt;Dans ce cas, nous avons un processus qui est d√©clench√© lors de la r√©ception d‚Äôun fichier. Nous pourrons par exemple avec ce genre d‚Äôarchitecture un fichier qui est envoy√© dans espace de stockage objet. Ce dernier est ensuite trait√© par un programme.
J‚Äôai fait le choix ici de mettre en oeuvre un couplage l√¢che (on ne se refait pas) entre l‚Äôespace de r√©ception de fichiers et le traitement.&lt;/p&gt;

&lt;p&gt;Je traite ici le risque de crash d‚Äôun POD en gardant syst√©matiquement les fichiers dans un stockage objet. De cette mani√®re, si le traitement a √©chou√©, un autre POD pourra le t√©l√©charger et rejouer le processus batch.&lt;/p&gt;

&lt;p&gt;Ce d√©couplage permet de g√©rer facilement la scalabilit√© et les arr√™ts/relances de PODs.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/05/batch_evenement-Batch_sur_presence_fichier.svg&quot; alt=&quot;batch_evenement-Batch_sur_presence_fichier&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dans ce cas, le batch pourra √™tre d√©ploy√© sous la forme d‚Äôun &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&quot;&gt;d√©ploiement Kubernetes&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;traitement-d√©clench√©-√†-distance-par-ex-par-un-orchestrateur-de-traitements&quot;&gt;Traitement d√©clench√© √† distance (par ex. par un orchestrateur de traitements)&lt;/h2&gt;

&lt;p&gt;Maintenant, on va aborder les traitements qui sont lanc√©s par un ordonnanceur tiers ou tout simplement lanc√© √† distance. 
G√©n√©ralement, dans le monde de l‚Äôentreprise, la planification des traitements est centralis√©e au lieu de laisser de le faire sur chaque machine avec des &lt;a href=&quot;https://en.wikipedia.org/wiki/Cron&quot;&gt;CRON Jobs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Dans ce cas, on a deux mani√®res de proc√©der:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Avoir un traitement qui fournit une API permettant de d√©marrer des traitements et d‚Äôavoir leurs statuts.&lt;/li&gt;
  &lt;li&gt;Lancer des jobs.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;avec-une-api&quot;&gt;Avec une API&lt;/h3&gt;

&lt;p&gt;Ici, on con√ßoit les batchs comme des WEBAPPS qui fournissent des traitements batchs sur demande via des APIs. La contrainte est qu‚Äô√† l‚Äôinstar de la solution pr√©c√©dente, le programme tourne toujours et n‚Äôest vraiment utile que lorsqu‚Äôil est appel√© via un endpoint REST.&lt;/p&gt;

&lt;p&gt;Ce mod√®le de conception peut √™tre utilis√© √† mon avis si la fr√©quence est forte et si l‚Äôint√©gration d‚Äôun Job Kubernetes est probl√©matique pour vous (voir ci-dessous).&lt;/p&gt;

&lt;p&gt;L‚Äôun des avantages que l‚Äôon pourra trouver est que le &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&quot;&gt;mode de d√©ploiement est assez simple et similaire aux APIs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/05/traitement_api.svg&quot; alt=&quot;traitement_api&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;avec-des-jobs&quot;&gt;Avec des jobs&lt;/h3&gt;

&lt;p&gt;Si votre ordonnanceur peut ex√©cuter le client kubectl, vous pourrez consid√©rer les &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/job/&quot;&gt;jobs  kubernetes&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;En r√©sum√©, ils permettent de cr√©er un POD et ex√©cute une action en g√©rant les erreurs potentielles jusqu‚Äô√† compl√©tion du traitement.&lt;/p&gt;

&lt;p&gt;Par exemple, voici un job permettant de faire un ‚ÄúHello World!‚Äù:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;batch/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Job&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello-world&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;helloworld&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;busybox&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;echo&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;World!&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Never&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Une fois d√©ploy√© avec Helm, vous pouvez les voir avec la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kubectl get jobs&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;minikube kubectl &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; get &lt;span class=&quot;nb&quot;&gt;jobs
&lt;/span&gt;NAME          COMPLETIONS   DURATION   AGE
hello-world   0/1           25s        25s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour les logs et voir le r√©sultat de la commande lanc√©, cela se passe d‚Äôune mani√®re assez habituelle:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;minikube kubectl &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; logs hello-world-zx4wh
Hello World!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;traitement-d√©clench√©-par-cron&quot;&gt;Traitement d√©clench√© par CRON&lt;/h2&gt;

&lt;p&gt;Maintenant, on va laisser le soin au Cluster Kubernetes de lancer les diff√©rents traitements via une CRON.
Bien que je ne suis pas trop fan de ne pas centraliser l‚Äôordonnancement, cela peut √™tre tr√®s utile si votre plateforme est centr√©e sur Kubernetes.&lt;/p&gt;

&lt;p&gt;Si vous √™tes dans ce cas-l√†, vous pouvez utiliser l‚Äôobjet &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/&quot;&gt;CronJob&lt;/a&gt; qui n‚Äôest ni plus ni moins qu‚Äôun &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/job/&quot;&gt;Job&lt;/a&gt; ex√©cut√© de mani√®re p√©riodique.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;batch/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;CronJob&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;jobTemplate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;helloworld-cron&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;busybox&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;echo&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;World!&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;OnFailure&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;panorama-des-solutions-logicielles-possibles&quot;&gt;Panorama des solutions logicielles possibles&lt;/h2&gt;

&lt;p&gt;Une fois qu‚Äôon s‚Äôest pos√© toutes (en tout cas certaines) les questions possibles sur nos exigences techniques et la conception, on peut voir quelles sont les technologies possibles pour impl√©menter des batchs ‚Äúcloud natifs‚Äù.&lt;/p&gt;

&lt;p&gt;√áa ne sera pas une surprise, je vais m‚Äôattarder √† la plateforme Java. Il est bien √©videmment possible d‚Äôutiliser d‚Äôautres langages et frameworks tels que Go.&lt;/p&gt;

&lt;p&gt;En Java, vous avez le choix entre diff√©rents frameworks :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;[Spring avec spring batch et/ou integration&quot;&gt;Spring avec spring batch&lt;/a&gt; et/ou &lt;a href=&quot;https://spring.io/projects/spring-integration&quot;&gt;integration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://camel.apache.org/&quot;&gt;Camel&lt;/a&gt; qui peut √™tre utilis√© avec &lt;a href=&quot;https://camel.apache.org/manual/spring.html&quot;&gt;Spring&lt;/a&gt; ou &lt;a href=&quot;https://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt; avec la &lt;a href=&quot;https://github.com/quarkiverse/quarkus-jberet&quot;&gt;JSR 352&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si vous allez du c√¥t√© du BigData, vous pouvez aussi envisager d‚Äôutiliser des technologies telles qu‚Äô&lt;a href=&quot;https://spark.apache.org/&quot;&gt;Apache Spark&lt;/a&gt;.
Ces derni√®res vous permettront de &lt;a href=&quot;https://spark.apache.org/docs/latest/running-on-kubernetes.html&quot;&gt;d√©couper ‚Äúplus facilement‚Äù vos traitements&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;le-diable-se-cache-dans-les-d√©tails&quot;&gt;Le diable se cache dans les d√©tails&lt;/h2&gt;

&lt;p&gt;D√©ployer un batch dans Kubernetes peut se faire assez facilement (en d√©veloppement) une fois qu‚Äôon a compris quelques principes. 
Cependant, les soucis peuvent survenir une fois arriv√© en production.&lt;/p&gt;

&lt;p&gt;La gestion des erreurs est beaucoup plus complexe que les APIs. Il vous faudra donc d√©finir avec les diff√©rentes parties prenantes quel est le meilleur fonctionnement (rejeu) en production. 
Il vous faudra ainsi bien &lt;a href=&quot;https://blog.touret.info/2022/02/09/analyser-les-risques-pour-mieux-definir-une-architecture/&quot;&gt;identifier et √©valuer les risques li√©s √† votre application&lt;/a&gt; et voir quelles sont les actions √† mener.&lt;/p&gt;

&lt;p&gt;Aussi, si vous devez manipuler des fichiers volumineux, il faudra faire attention au syst√®me de fichiers utilis√© et ses performances. Habituellement, avec ce type d‚Äôarchitecture, on utilise g√©n√©ralement du SAN. En fonction de vos exigences, un &lt;a href=&quot;https://www.redhat.com/fr/topics/data-storage/file-block-object-storage&quot;&gt;stockage block&lt;/a&gt; pourra √™tre plus adapt√©.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Pour conclure cet article, vous aurez compris que le sujet des batchs dans Kubernetes peut s‚Äôav√©rer assez complexe √† g√©rer. 
Au-del√† des technologies qui peuvent faire le job (&lt;em&gt;d√©sol√© du mauvais jeu de mots&lt;/em&gt;), il vous faudra faire tr√®s attention √† tout l‚Äôenvironnement dans lequel votre programme devra interagir. Les bases, le r√©seau, les performances de votre mat√©riel seront des pr√©requis indispensables.&lt;/p&gt;

&lt;p&gt;Aussi, il vous faudra faire attention √† la mani√®re dont sont transmises les donn√©es et dont vous les traitez. 
Bref, il faut √©tudier la solution dans son ensemble du d√©veloppement √† l‚Äôexploitation pour s‚Äôassurer de ne rien oublier.&lt;/p&gt;

&lt;p&gt;Enfin, cet article n‚Äôest bien √©videmment pas exhaustif que cela soit sur les solutions ou les contraintes √† adresser. 
J‚Äôai n√©anmoins essay√© d‚Äôapporter quelques cas concrets et retours d‚Äôexp√©rience.&lt;/p&gt;

&lt;p&gt;J‚Äôessaierai de d√©tailler un cas concret dans un prochain article.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="cloud" /><category term="kubernetes" /><category term="batch" /><summary type="html">Quand on parle du Cloud et de Kubernetes, g√©n√©ralement on pense aux APIs. Mais qu‚Äôen est-il des batchs?</summary></entry><entry><title type="html">Mieux analyser les risques pour simplifier les architectures (ou pas)</title><link href="https://blog.touret.info/2022/02/09/analyser-les-risques-pour-mieux-definir-une-architecture/" rel="alternate" type="text/html" title="Mieux analyser les risques pour simplifier les architectures (ou pas)" /><published>2022-02-09T08:00:00+00:00</published><updated>2022-02-09T08:00:00+00:00</updated><id>https://blog.touret.info/2022/02/09/analyser-les-risques-pour-mieux-definir-une-architecture</id><content type="html" xml:base="https://blog.touret.info/2022/02/09/analyser-les-risques-pour-mieux-definir-une-architecture/">&lt;p&gt;&lt;img src=&quot;/assets/images/2022/02/architecture.webp&quot; alt=&quot;architecture&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;lanalyse-des-risques-kezako-&quot;&gt;L‚Äôanalyse des risques: kezako ?&lt;/h2&gt;

&lt;p&gt;Souvent utilis√©e dans la prise de d√©cision, l‚Äôanalyse des risques a plusieurs objectifs :&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Permettre de pond√©rer des risques potentiels&lt;/li&gt;
  &lt;li&gt;Faciliter la prise de d√©cision sur les actions √† r√©aliser pour les pr√©venir ou tout du moins les att√©nuer.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Mais d‚Äôabord, revenons aux bases. Comment identifier un risque ?&lt;/p&gt;

&lt;p&gt;Selon &lt;a href=&quot;https://fr.wikipedia.org/wiki/Risque&quot;&gt;Wikipedia&lt;/a&gt;, voici la d√©finition:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Le risque est la possibilit√© de survenue d‚Äôun √©v√©nement ind√©sirable, la probabilit√© d‚Äôoccurrence d‚Äôun p√©ril probable ou d‚Äôun al√©a.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Bien √©videmment, on a les risques inconnus et ceux qui sont connus. 
Le pr√©alable √† toute gestion de risque (tout du moins pour la d√©finition d‚Äôarchitecture) est de capitaliser les connaissances et retours d‚Äôexp√©rience qui viennent du terrain.&lt;/p&gt;

&lt;p&gt;On va donc oublier les risques inconnus dans cet article.&lt;/p&gt;

&lt;h3 id=&quot;comment-les-d√©finir-&quot;&gt;Comment les d√©finir ?&lt;/h3&gt;

&lt;p&gt;Tout d‚Äôabord, il faut conna√Ætre les &lt;a href=&quot;https://sre.google/workbook/implementing-slos/&quot;&gt;SLOs&lt;/a&gt; de la plateforme qu‚Äôon souhaite concevoir. Pourquoi ? Pour v√©rifier si les risques qu‚Äôon identifiera plus tard sont pertinents ou tout du moins impactants.&lt;/p&gt;

&lt;p&gt;Par exemple: Une panne √©lectrique sera faiblement impactante pour une application avec une disponibilit√© &amp;lt; 70%.&lt;/p&gt;

&lt;p&gt;La r√©alisation des SLIs et SLOs est un pr√©alable pour d√©finir &lt;a href=&quot;https://cloud.google.com/blog/products/management-tools/sre-error-budgets-and-maintenance-windows&quot;&gt;le ‚Äúbudget d‚Äôerreur‚Äù&lt;/a&gt;. 
Ce dernier nous permettra &lt;em&gt;in fine&lt;/em&gt; de quantifier les risques et de voir si il faut les att√©nuer.&lt;/p&gt;

&lt;p&gt;Ensuite, pour chaque risque qu‚Äôon identifiera (souvent √† partir de notre exp√©rience), on t√¢chera de d√©finir les caract√©ristiques suivantes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cause&lt;/li&gt;
  &lt;li&gt;Probabilit√©&lt;/li&gt;
  &lt;li&gt;Cons√©quence (gravit√©)&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;un-exemple&quot;&gt;Un exemple&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;La base de donn√©es est indisponible&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cause: Syst√®me de fichier plein&lt;/li&gt;
  &lt;li&gt;Probabilit√©: faible&lt;/li&gt;
  &lt;li&gt;Cons√©quence: forte (toute la plateforme est HS)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Pour d√©terminer la cause, il y a plusieurs m√©thodes, l‚Äôune des plus c√©l√®bres est celle &lt;a href=&quot;https://fr.wikipedia.org/wiki/Cinq_pourquoi&quot;&gt;des cinq pourquoi&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Elle permet d‚Äôacc√©der √† la cause du probl√®me.&lt;/p&gt;

&lt;p&gt;Pour √©tablir la probabilit√©, les OPS seront vos meilleurs ami.e.s. 
Vous remontrez dans le temps pour d√©terminer quels ont √©t√© les diff√©rents incidents.
Pour chacun, vous devrez d√©finir ces trois caract√©ristiques : cause, probabilit√©, cons√©quence.&lt;/p&gt;

&lt;p&gt;A cot√© de √ßa, vous aurez √† identifier si possible le temps d‚Äôindisponibilit√© du service.&lt;/p&gt;

&lt;h3 id=&quot;synth√®se&quot;&gt;Synth√®se&lt;/h3&gt;

&lt;p&gt;Une fois ce travail de fourmi r√©alis√©, vous pourrez le synth√©tiser dans un premier temps avec ce formalisme souvent repris dans la gestion de projet:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/02/Risk-Based-Audit_technical.webp&quot; alt=&quot;analyse de risques&quot; /&gt;&lt;/p&gt;

&lt;p&gt;En r√©sum√©, les actions qui sont oranges ou rouges doivent √™tre trait√©es et avoir un plan d‚Äôaction.&lt;/p&gt;

&lt;p&gt;Prenons la d√©finition d‚Äôune plateforme: 
Si votre API doit traiter de mani√®re r√©guli√®re des PAYLOADs volumineux (bon d√©j√†, la ce n‚Äôest pas top).
Le temps de traitement peut √™tre tr√®s long et bloquer certaines ressources (ex. des sous transactions).&lt;/p&gt;

&lt;p&gt;Dans ce cas, la probabilit√© sera √† probable et l‚Äôimpact sera mod√©r√© ou majeur. Par cons√©quent, vous devrez le prendre en compte avec par exemple un &lt;a href=&quot;https://blog.touret.info/2021/07/26/observabilite-et-circuit-breaker-avec-spring/&quot;&gt;circuit breaker&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pour aller encore plus loin, vous pouvez √©galement √©valuer les risques en fonction de votre budget d‚Äôerreur: Est-ce que l‚Äôerreur peut rentrer dans mon budget ou pas? 
Bref, est-ce acceptable?&lt;/p&gt;

&lt;p&gt;Si vous allez plus loin, je vous conseille la formation &lt;a href=&quot;https://www.coursera.org/learn/site-reliability-engineering-slos&quot;&gt;Coursera Site Reliability Engineering: Measuring and Managing Reliability&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;ok-jai-identifi√©-les-risques-potentiels-quest-ce-que-jen-fait-maintenant&quot;&gt;OK, j‚Äôai identifi√© les risques potentiels. Qu‚Äôest-ce que j‚Äôen fait maintenant?&lt;/h2&gt;

&lt;p&gt;C‚Äôest l√† que d√©marre r√©ellement le travail d‚Äôarchitecture: vous devrez √©valuer chaque risque en fonction des exigences fonctionnelles et technique pour savoir si elles valent la peine d‚Äô√™tre prises en consid√©ration. 
Si vous avez des risques de faible impact, vous pourrez soit les ‚Äúmettre sous contr√¥le‚Äù pour traiter d‚Äôautres probl√®mes, soit les traiter car ils sont ‚Äúfaciles‚Äù √† traiter et vous permettront d‚Äôagrandir votre ‚Äúbudget d‚Äôerreur‚Äù. 
Dans ce dernier cas, vous aurez la possibilit√© de laisser ‚Äúde cot√©‚Äù d‚Äôautres erreurs plus compliqu√©es √† traiter car elles rentreront dans votre budget.&lt;/p&gt;

&lt;p&gt;Bref, c‚Äôest un vrai travail de fourmi qui se base sur l‚Äôexp√©rience du terrain.&lt;/p&gt;

&lt;h2 id=&quot;quid-de-larchitecture&quot;&gt;&lt;em&gt;Quid&lt;/em&gt; de l‚Äôarchitecture?&lt;/h2&gt;

&lt;p&gt;Si vous avez √©valu√© les risques correctement, vous pourrez ne traiter que les risques qui en valent la peine et par cons√©quent n‚Äô ajouter de la complexit√© que l√† ou √ßa en vaut la peine!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Oui, ce travail pr√©alable permet de faire simple!&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;un-exemple-concret&quot;&gt;Un exemple concret&lt;/h2&gt;

&lt;p&gt;Si je reprends l‚Äôapplication &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring&quot;&gt;bookstore&lt;/a&gt; que j‚Äôai d√©crite dans &lt;a href=&quot;https://blog.touret.info/2021/07/26/observabilite-et-circuit-breaker-avec-spring/&quot;&gt;un pr√©c√©dent article&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/07/rest-book-architecture.png&quot; alt=&quot;bookstore architecture&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;exigences-techniques&quot;&gt;Exigences techniques&lt;/h3&gt;

&lt;h4 id=&quot;slos--slis&quot;&gt;SLOs / SLIs&lt;/h4&gt;

&lt;p&gt;Pour cet exemple, je ne vais traiter que deux exigences techniques:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;SLO&lt;/th&gt;
      &lt;th&gt;SLI&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;L‚ÄôAPI Bookstore doit √™tre disponible 99%&lt;/td&gt;
      &lt;td&gt;Nombre de r√©ponses HTTP = 2XX ou 4XX&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;L‚ÄôAPI Bookstore doit r√©pondre en moins de 1 sec&lt;/td&gt;
      &lt;td&gt;Temps de r√©ponse de l‚ÄôAPI&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;volum√©trie&quot;&gt;Volum√©trie&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;100 transactions par seconde (TPS)&lt;/li&gt;
  &lt;li&gt;100 utilisateurs simultan√©s&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;risques-identifi√©s&quot;&gt;Risques identifi√©s&lt;/h3&gt;

&lt;p&gt;Sans aller dans le d√©tail, voici quelques risques que l‚Äôon peut identifier de prime abord dans cette architecture:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Indisponibilit√© du service bookstore&lt;/li&gt;
  &lt;li&gt;Indisponibilit√© du service booknumber&lt;/li&gt;
  &lt;li&gt;Indisponibilit√© de la base de donn√©es √† cause d‚Äôune forte volum√©trie&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;En vous basant sur l‚Äôexp√©rience de vos OPS, vous pourrez √©galement ajouter des risques li√©s √† l‚Äôinfrastructure (routeurs, DNS, ‚Ä¶). 
Je ne vais pas les aborder dans cet article.&lt;/p&gt;

&lt;h3 id=&quot;qualification-des-risques&quot;&gt;Qualification des risques&lt;/h3&gt;

&lt;p&gt;Voici une rapide qualification:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Risques&lt;/th&gt;
      &lt;th&gt;Probabilit√©&lt;/th&gt;
      &lt;th&gt;Impact&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Indisponibilit√© du service bookstore&lt;/td&gt;
      &lt;td&gt;Probable&lt;/td&gt;
      &lt;td&gt;Majeur&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Indisponibilit√© du service booknumber&lt;/td&gt;
      &lt;td&gt;Probable&lt;/td&gt;
      &lt;td&gt;Majeur&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Indisponibilit√© de la base de donn√©es&lt;/td&gt;
      &lt;td&gt;Possible&lt;/td&gt;
      &lt;td&gt;Catastrophique&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Si on se r√©f√®re au premier diagramme, il est obligatoire de les prendre en compte.&lt;/p&gt;

&lt;h3 id=&quot;solutions-darchitecture-pour-leur-prise-en-compte&quot;&gt;Solutions d‚Äôarchitecture pour leur prise en compte&lt;/h3&gt;

&lt;p&gt;Une fois les risques identifi√©s, on peut tout d‚Äôabord les confronter √† notre budget d‚Äôerreur pour valider leur prise en compte dans notre conception.&lt;/p&gt;

&lt;p&gt;Dans notre cas, on va prendre le postulat qu‚Äôil faut r√©ellement les prendre en consid√©ration et trouver une solution adapt√©e.&lt;/p&gt;

&lt;p&gt;Voici des exemples de solutions qui permettraient de faire descendre leur impact our leur probabilit√©.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Risques&lt;/th&gt;
      &lt;th&gt;Probabilit√©&lt;/th&gt;
      &lt;th&gt;Impact&lt;/th&gt;
      &lt;th&gt;Action/Solutions possibles&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Indisponibilit√© du service bookstore&lt;/td&gt;
      &lt;td&gt;Possible&lt;/td&gt;
      &lt;td&gt;Majeur&lt;/td&gt;
      &lt;td&gt;Load balancing avec deux instances, Utilisation Kubernetes,.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Indisponibilit√© du service booknumber&lt;/td&gt;
      &lt;td&gt;Possible&lt;/td&gt;
      &lt;td&gt;Majeur&lt;/td&gt;
      &lt;td&gt;Sur le service book-number:&lt;br /&gt;Load balancing avec deux instances, Utilisation Kubernetes,..&lt;br /&gt;&lt;br /&gt;Sur le service bookstore:&lt;br /&gt;&lt;br /&gt;Mettre en place un circuit breaker bas√© sur le timeout d‚Äôappel &lt;br /&gt;vers le service book-number pour garantir la SLO&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Indisponibilit√© de la base de donn√©es&lt;/td&gt;
      &lt;td&gt;Possible&lt;/td&gt;
      &lt;td&gt;Catastrophique&lt;/td&gt;
      &lt;td&gt;- R√©alisation d‚Äôun benchmark pour s‚Äôassurer qu‚Äôune instance est suffisante.&lt;br /&gt;&lt;br /&gt;- Sinon mise en place m√©canisme HA ou changement de technologie&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;L‚Äôanalyse des risques n‚Äôest pas r√©cente et n‚Äôa pas √©t√© invent√©e par le monde de l‚Äôinformatique.
Elle est d‚Äôabord apparue dans la gestion de projets et fait d√©sormais partie prenante de la d√©finition d‚Äôarchitectures (enfin √ßa commence‚Ä¶).
Il ne faut pas la voir seulement pour un outil de ‚ÄúGO-NO GO‚Äù de r√©union de cellule de crise mais comme une aide √† la d√©cision pour la conception des syst√®mes.&lt;/p&gt;

&lt;p&gt;Il a toute sa place √† cot√© des diff√©rentes caract√©ristiques que vous devrez prendre en compte ( s√©curit√©, modularit√©, ‚Ä¶).
J‚Äôai essay√© de d√©crire comment les identifier et trouver une solution adapt√©e dans l‚Äôexemple.
Bien √©videmment, il n‚Äôest pas complet. 
Je pense n√©anmoins qu‚Äôil permet d‚Äôavoir une id√©e sur le sujet.&lt;/p&gt;

&lt;p&gt;Le principal avantage d‚Äôutiliser √† la fois les SLOs/SLIs, le budget d‚Äôerreur et l‚Äôanalyse des risques est de &lt;strong&gt;n‚Äôapporter de la complexit√© que l√† o√π c‚Äôest n√©cessaire&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Pour certains un benchmark sera souvent utile pour confirmer votre d√©cision.&lt;/p&gt;

&lt;p&gt;Si vous voulez aller plus loin, je vous conseille dans un premier temps de lire &lt;a href=&quot;https://fundamentalsofsoftwarearchitecture.com/&quot;&gt;‚ÄúFundamentals of Software Architecture‚Äù&lt;/a&gt;. 
Ce sujet y est abord√©.&lt;/p&gt;

&lt;p&gt;Enfin,si ce sujet vous int√©resse, vous pouvez vous projeter au d√©l√† de l‚Äôinformatique en lisant les analyses de risques r√©alis√©es par &lt;a href=&quot;https://www.economie.gouv.fr/files/files/directions_services/tracfin/analyse-nationale-des-risques-lcb-ft-en-France-septembre-2019.pdf&quot;&gt;le Minist√®re des finances&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Bonne lecture ;-)&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="architecture" /><summary type="html"></summary></entry><entry><title type="html">Mettre en oeuvre des Github Actions utiles pour un site h√©berg√© sur Github pages</title><link href="https://blog.touret.info/2021/12/19/mettre-en-oeuvre-github-actions-utiles-pour-un-site-heberge-sur-github-io/" rel="alternate" type="text/html" title="Mettre en oeuvre des Github Actions utiles pour un site h√©berg√© sur Github pages" /><published>2021-12-19T12:00:00+00:00</published><updated>2021-12-19T12:00:00+00:00</updated><id>https://blog.touret.info/2021/12/19/mettre-en-oeuvre-github-actions-utiles-pour-un-site-heberge-sur-github-io</id><content type="html" xml:base="https://blog.touret.info/2021/12/19/mettre-en-oeuvre-github-actions-utiles-pour-un-site-heberge-sur-github-io/">&lt;p&gt;&lt;img src=&quot;/assets/images/2021/12/github-1.jpg&quot; alt=&quot;github&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-mettre-en-oeuvre-des-github-actions-&quot;&gt;Pourquoi mettre en oeuvre des GITHUB ACTIONS ?&lt;/h2&gt;

&lt;p&gt;Comme j‚Äôai pu l‚Äôexpliquer dans &lt;a href=&quot;https://blog.touret.info/2021/12/06/migrer-un-blog-wordpress-vers-github-io/&quot;&gt;mon pr√©c√©dent article&lt;/a&gt;, je suis pass√© de &lt;a href=&quot;wordpress.com/&quot;&gt;Wordpress&lt;/a&gt; √† &lt;a href=&quot;https://pages.github.com/&quot;&gt;GITHUB Pages&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Une fois le site d√©ploy√© une premi√®re fois, on voit qu‚Äôon a perdu pas mal d‚Äôautomatisations qui sont r√©alis√©es par d√©faut dans Wordpress. Par exemple, vous devez construire votre site, publier des nouveaux articles et v√©rifier que tout est OK.&lt;/p&gt;

&lt;p&gt;J‚Äôai donc mis en oeuvre des GITHUB ACTIONS pour automatiser le plus d‚Äôactions possibles et me passer de t√¢ches manuelles souvent r√©barbatives.&lt;/p&gt;

&lt;p&gt;Si vous souhaitez d√©couvrir les GITHUB ACTIONS, je vous conseille &lt;a href=&quot;https://github.com/features/actions&quot;&gt;ce site&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;construction-du-site-et-d√©ploiement&quot;&gt;Construction du site et d√©ploiement&lt;/h2&gt;

&lt;p&gt;D√®s qu‚Äôon touche √† Jekyll et √† l‚Äôh√©bergement sur Github Pages, on tombe sur certaines actions √† r√©aliser telles que celle-ci:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bundle &lt;span class=&quot;nb&quot;&gt;exec &lt;/span&gt;jekyll build 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;J‚Äôai donc r√©alis√© les workflows suivants:&lt;/p&gt;

&lt;h3 id=&quot;pour-une-feature-branch-dans-une-pull-request&quot;&gt;Pour une feature branch (dans une Pull Request)&lt;/h3&gt;
&lt;p&gt;Je construis le site sans le d√©ployer pour v√©rifier que la construction est correcte.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Build Jekyll site&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;branches-ignore&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;(1)&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;- main&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;- gh-pages&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;jekyll&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# can change this to ubuntu-latest if you prefer&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üìÇ setup (2)&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/checkout@v2&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;# include the lines below if you are using jekyll-last-modified-at&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# or if you would otherwise need to fetch the full commit history&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# however this may be very slow for large repositories!&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# with:&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;# fetch-depth: '0'&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üíé setup ruby  (3)&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ruby/setup-ruby@v1&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;ruby-version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2.6&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# can change this to 2.7 or whatever version you prefer&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;bundler-cache&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
      
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üî® install dependencies &amp;amp; build site (4)&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle exec jekyll build&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Voila ce que ce workflow r√©alise:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Il est ex√©cut√© √† chaque push except√© sur les branches main et gh-pages. Ce sont les branches que j‚Äôutilise pour le d√©ploiement du site apr√®s la validation d‚Äôune pull request.&lt;/li&gt;
  &lt;li&gt;Checkout du projet&lt;/li&gt;
  &lt;li&gt;Initialisation de Ruby et t√©l√©chargement des d√©pendances comme le ferait la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bundle install&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Construction du site&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;pour-la-branche-main&quot;&gt;Pour la branche main&lt;/h3&gt;

&lt;p&gt;Une fois que la pull request est valid√©e, le code est pouss√© dans la branche main. On y ex√©cute le code suivant:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Build and deploy Jekyll site to GitHub Pages&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;main&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;jekyll&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# can change this to ubuntu-latest if you prefer&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üìÇ setup&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/checkout@v2&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üíé setup ruby&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ruby/setup-ruby@v1&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;ruby-version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2.6&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# can change this to 2.7 or whatever version you prefer&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;bundler-cache&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
      
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üî® install dependencies &amp;amp; build site&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;bundle exec jekyll build&lt;/span&gt;

      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üöÄ deploy&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;peaceiris/actions-gh-pages@v3&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;github_token&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;publish_dir&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;./_site&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ce dernier reprend le code du workflow suivant ( oui, j‚Äôaurai pu faire des workflows r√©utilisables‚Ä¶ ) et ajoute l‚Äô√©tape de d√©ploiement.
Le code g√©n√©r√© sera copi√© dans la branche &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gh-pages&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;publication-dun-article&quot;&gt;Publication d‚Äôun article&lt;/h2&gt;

&lt;p&gt;Pour r√©diger un article, j‚Äôutilise le m√©canisme de feature branch et pull request. Pour automatiser la publication, le nommage des articles avec la date etc, j‚Äôai mis en oeuvre le workflow suivant:&lt;/p&gt;

&lt;p&gt;Je r√©dige les articles (comme celui-ci) et les positionne dans le r√©pertoire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_drafts&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-R&lt;/span&gt; _drafts                                                                                               
quelques-github-actions-utiles-pour-un-site-jekyll-heberge-sur-github-io.md
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;J‚Äôassocie un &lt;a href=&quot;https://docs.github.com/en/issues/using-labels-and-milestones-to-track-work/about-milestones&quot;&gt;milestone&lt;/a&gt; √† la &lt;a href=&quot;https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests&quot;&gt;pull request&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;D√®s que ces derniers sont termin√©s, le workflow d√©crit ci-dessous est ex√©cut√©. 
Il permet, via un script python de:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Identifier les articles dans le r√©pertoire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_drafts&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;V√©rifier que la date de publication sp√©fici√© dans l‚Äôen-t√™te est ant√©rieure √† la date courante (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;now()&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;Copier le fichier dans le r√©pertoire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_posts&lt;/code&gt; en le renommant avec la date en pr√©fixe.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Publish Drafts&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;(1)&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;milestone&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;closed&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;workflow_dispatch&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/checkout@v2&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;ref&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;main (2)&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üìÇ setup python&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/setup-python@v2&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;python-version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;3.7.7'&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# install the python version needed&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üíé install python packages (3)&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;|&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;python -m pip install --upgrade pip &lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;  &lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üî® execute py script  (4)&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;python publish_drafts.py&lt;/span&gt;
          
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;üî® commit files (5)&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;|&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;if git ls-files -o  --exclude-standard; then&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;git config --local user.email &quot;action@github.com&quot;&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;git config --local user.name &quot;GitHub Action&quot;&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;git add -A&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;git commit -m &quot;publish drafts&quot; -a&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;git push origin main&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;echo &quot;No file to publish&quot;&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;fi&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;  &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Explication:&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;D√©clenchement manuel ou √† la cl√¥ture d‚Äôun milestone&lt;/li&gt;
  &lt;li&gt;R√©cup√©ration de la branche &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Installation de packages python&lt;/li&gt;
  &lt;li&gt;Ex√©cution du &lt;a href=&quot;https://github.com/alexandre-touret/alexandre-touret.github.io/blob/main/publish_drafts.py&quot;&gt;script python r√©alis√© pour l‚Äôoccasion&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Commit et push&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Une fois ce workflow r√©alis√©, le workflow vu pr√©c√©demment est automatiquement lanc√© et le site est g√©n√©r√© une nouvelle fois. Bon √ßa fait deux constructions, mais au vu du temps pris, c‚Äôest n√©gligeable.&lt;/p&gt;

&lt;h2 id=&quot;uptime&quot;&gt;Uptime&lt;/h2&gt;

&lt;p&gt;J‚Äôaurai pu utiliser un tiers service tel que &lt;a href=&quot;https://uptimerobot.com/&quot;&gt;uptime robot&lt;/a&gt;. 
Pour mon besoin, j‚Äôai pr√©f√©r√© opter pour un appel r√©gulier du site et une v√©rification du code HTTP (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;200&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# This is a basic workflow to help you get started with Actions&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Uptime Monitoring&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;(1)&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;- cron&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*/60&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*'&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;ping_site&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Ping the site&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Check the site&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;srt32/uptime@master&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;url-to-hit&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;https://blog.touret.info/robots.txt&quot;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;(2)&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;expected-statuses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;200,301&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Explications&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;D√©clenchement toutes les heures de ce workflow&lt;/li&gt;
  &lt;li&gt;J‚Äôai utilis√© une GITHUB ACTION existante qui ping une URL et v√©rifie le code retour. Dans mon cas, j‚Äôai utilis√© l‚ÄôURL du fichier &lt;a href=&quot;https://developers.google.com/search/docs/advanced/robots/intro?hl=fr&quot;&gt;robots.txt&lt;/a&gt; et je v√©rifie le code retour.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;J‚Äôai r√©ussi √† plus ou moins automatiser tout le cycle de construction d‚Äôarticles. 
C‚Äôest encore perfectible et loin de certaines fonctionnalit√©s de Wordpress, mais je n‚Äôen ai pas r√©ellement besoin.&lt;/p&gt;

&lt;p&gt;Si vous souhaitez r√©utiliser ces workflows et les int√©grer dans sites, vous pouvez les r√©cup√©rer &lt;a href=&quot;https://github.com/alexandre-touret/alexandre-touret.github.io&quot;&gt;sur ce repo GITHUB&lt;/a&gt;.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="github" /><category term="jekyll" /><category term="github-actions" /><category term="planetlibre" /><summary type="html"></summary></entry><entry><title type="html">Migrer son blog Wordpress vers GitHub</title><link href="https://blog.touret.info/2021/12/06/migrer-un-blog-wordpress-vers-github-io/" rel="alternate" type="text/html" title="Migrer son blog Wordpress vers GitHub" /><published>2021-12-06T10:00:00+00:00</published><updated>2021-12-06T10:00:00+00:00</updated><id>https://blog.touret.info/2021/12/06/migrer-un-blog-wordpress-vers-github-io</id><content type="html" xml:base="https://blog.touret.info/2021/12/06/migrer-un-blog-wordpress-vers-github-io/">&lt;p&gt;L‚Äôid√©e me trottait dans la t√™te depuis quelques mois environ: migrer mon blog de Wordpress vers un site bas√© sur Jekyll et h√©berg√© directement sur Github.
La date de renouvellement de ma souscription Wordpress arrivant √† terme, je me suis d√©cid√© √† franchir le pas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/12/sebastien-goldberg-AW5MxlFDVzc-unsplash.jpg&quot; alt=&quot;migration&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;l-h√©bergement-de-sites-web-sur-github&quot;&gt;L‚Äô h√©bergement de sites web sur Github&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll&quot;&gt;Github permet via son service Github Pages d‚Äôh√©berger des sites statiques&lt;/a&gt; (c.-√†-d. pas de base de donn√©es derri√®re) en permettant d‚Äôassocier son nom de domaine. 
Le certificat est automatiquement g√©n√©r√©.&lt;/p&gt;

&lt;p&gt;Pour avoir un look un peu sympa, j‚Äôai donc mis en oeuvre les outils suivants:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com&quot;&gt;Jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://mmistakes.github.io/minimal-mistakes/&quot;&gt;Minimal Mistakes&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jekyllrb.com/docs/continuous-integration/github-actions/&quot;&gt;Github Actions pour construire le site&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.markdownguide.org/&quot;&gt;Markdown&lt;/a&gt; pour √©crire les diff√©rents articles&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;d√©marrer-avec-minimal-mistakes&quot;&gt;D√©marrer avec Minimal Mistakes&lt;/h2&gt;

&lt;p&gt;Je vous conseille d‚Äôaller sur &lt;a href=&quot;https://mmistakes.github.io/minimal-mistakes/&quot;&gt;ce site&lt;/a&gt;.
Tout est bien d√©taill√© est c‚Äôest r√©alisable en quelques minutes seulement.&lt;/p&gt;

&lt;h2 id=&quot;migration-des-donn√©es&quot;&gt;Migration des donn√©es&lt;/h2&gt;

&lt;p&gt;Sans surprise, c‚Äôest la partie la moins dr√¥le. Il faut en r√©sum√©:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Exporter les donn√©es si vous √™tes h√©berg√© sur wordpress.com&lt;/li&gt;
  &lt;li&gt;Les r√©-importer dans une instance locale&lt;/li&gt;
  &lt;li&gt;Les exporter au format Jekyll&lt;/li&gt;
  &lt;li&gt;Copier le contenu g√©n√©r√© dans un nouveau site&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;exporter-les-donn√©es&quot;&gt;Exporter les donn√©es&lt;/h3&gt;

&lt;p&gt;Afin d‚Äôexporter les donn√©es et de les transformer, il faut d‚Äôabord exporter les donn√©es (articles + m√©dias) de votre site Wordpress&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/12/Screenshot_2021-12-03_12-01-31.png&quot; alt=&quot;wordpress_export&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vous obtiendrez deux archives: la premi√®re pour les articles, la deuxi√®me pour les m√©dias.&lt;/p&gt;

&lt;p&gt;Cr√©ation d‚Äôune instance Wordpress pour convertir les donn√©es au format Jekyll&lt;/p&gt;

&lt;h3 id=&quot;importer-les-donn√©es&quot;&gt;Importer les donn√©es&lt;/h3&gt;

&lt;p&gt;Pour faire simple, j‚Äôutilise &lt;a href=&quot;https://docs.docker.com/samples/wordpress/&quot;&gt;Docker pour monter une architecture Wordpress sur mon poste&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Il faut pour √ßa cr√©er un fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; et ins√©rer le contenu suivant:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;3.9&quot;&lt;/span&gt;
    
&lt;span class=&quot;na&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mysql:5.7&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;db_data:/var/lib/mysql&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;MYSQL_ROOT_PASSWORD&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;somewordpress&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;MYSQL_DATABASE&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;MYSQL_USER&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;MYSQL_PASSWORD&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress&lt;/span&gt;
    
  &lt;span class=&quot;na&quot;&gt;wordpress&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;db&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress:latest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress_data:/var/www/html&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;8000:80&quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;WORDPRESS_DB_HOST&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;db:3306&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;WORDPRESS_DB_USER&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;WORDPRESS_DB_PASSWORD&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;WORDPRESS_DB_NAME&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;wordpress&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;db_data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;wordpress_data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ensuite, vous aurez √† lancer la commande suivante:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker-compose up
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Une fois lanc√©, vous aurez √† une instance Wordpress via cette URL : http://localhost:8000&lt;/p&gt;

&lt;p&gt;Ensuite, il faut installer l‚Äôextension &lt;a href=&quot;https://wordpress.org/plugins/jekyll-exporter/&quot;&gt;jekyll-exporter&lt;/a&gt;.
La proc√©dure peut prendre un peu de temps.&lt;/p&gt;

&lt;p&gt;Une fois effectu√©e, vous aurez une archive ZIP contenant un site Jekyll avec les images et articles associ√©s.&lt;/p&gt;

&lt;h2 id=&quot;cr√©ation-du-site&quot;&gt;Cr√©ation du site&lt;/h2&gt;

&lt;p&gt;En attendant que √ßa se termine, j‚Äôai cr√©e &lt;a href=&quot;https://github.com/mmistakes/mm-github-pages-starter/generate&quot;&gt;un site jekyll avec le starter du th√®me minimal mistakes&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;J‚Äôai ensuite copi√© les articles (r√©pertoire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/_posts&lt;/code&gt;) et images (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/assets/img&lt;/code&gt;).
Au premier lancement des commandes suivantes:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;bundle &lt;span class=&quot;nb&quot;&gt;install
&lt;/span&gt;bundle &lt;span class=&quot;nb&quot;&gt;exec &lt;/span&gt;jekyll serve
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;J‚Äôai eu quelques erreurs. J‚Äôai donc eu √† nettoyer les fichiers via des recherche/remplace dans un √©diteur&lt;/p&gt;

&lt;p&gt;Par exemple, j‚Äôai supprim√© les r√©f√©rences &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;author&lt;/code&gt; et &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;layout&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;author&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;admin&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;post&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;J‚Äôai √©galement ajout√© pour certains articles une image pour le teaser&lt;/p&gt;

&lt;p&gt;Exemple:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;teaser&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/assets/images/2021/07/rest-book-architecture.png&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;url-des-pages-et-compatibilit√©-wordpress--jekyll&quot;&gt;URL des pages et compatibilit√© Wordpress &amp;lt;&amp;gt; Jekyll&lt;/h3&gt;

&lt;p&gt;Pour me faciliter la vie dans les URLS et liens en tout genre, j‚Äôai gard√© le format des URLS de Wordpress.
Pour que √ßa soit le format par d√©faut de Jekyll, il faut modifier le param√®tre &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;permalink&lt;/code&gt; dans le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_config.yml&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;permalink&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/:year/:month/:day/:title/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;flux-rss-pour-un-tag-donn√©&quot;&gt;Flux RSS pour un tag donn√©&lt;/h3&gt;

&lt;p&gt;J‚Äôutilisais une petite sp√©cificit√© de Wordpress: la cr√©ation d‚Äôun flux RSS pour un tag donn√©. 
Pour le mettre en place dans Jekyll, il faut configurer le plugin &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;jekyll-feed&lt;/code&gt; avec les propri√©t√© suivantes:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;feed&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;et-maintenant-&quot;&gt;Et maintenant ?&lt;/h2&gt;

&lt;p&gt;J‚Äôai sans doute oubli√© quelques renommages/suppressions r√©alis√©s ici et l√†.
N√©anmoins, le principal est √©voqu√© dans cet article.&lt;/p&gt;

&lt;p&gt;Il ne vous reste plus qu‚Äô√† √©plucher la documentation du th√®me et de jekyll pour finaliser l‚Äô installation de votre nouveau site.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="github" /><category term="wordpress" /><category term="planetlibre" /><summary type="html">L‚Äôid√©e me trottait dans la t√™te depuis quelques mois environ: migrer mon blog de Wordpress vers un site bas√© sur Jekyll et h√©berg√© directement sur Github. La date de renouvellement de ma souscription Wordpress arrivant √† terme, je me suis d√©cid√© √† franchir le pas.</summary></entry><entry><title type="html">Observabilit√© et Circuit Breaker avec Spring</title><link href="https://blog.touret.info/2021/07/26/observabilite-et-circuit-breaker-avec-spring/" rel="alternate" type="text/html" title="Observabilit√© et Circuit Breaker avec Spring" /><published>2021-07-26T09:53:49+00:00</published><updated>2021-07-26T09:53:49+00:00</updated><id>https://blog.touret.info/2021/07/26/observabilite-et-circuit-breaker-avec-spring</id><content type="html" xml:base="https://blog.touret.info/2021/07/26/observabilite-et-circuit-breaker-avec-spring/">&lt;p&gt;Il y a quelques mois d√©j√†, je discutais avec &lt;a href=&quot;https://jefrajames.fr/&quot;&gt;un coll√®gue&lt;/a&gt; d‚Äô observabilit√©, &lt;a href=&quot;https://github.com/opentracing-contrib/java-spring-cloud&quot;&gt;opentracing&lt;/a&gt;, ‚Ä¶ avec &lt;a href=&quot;http://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt;. On est tomb√© sur &lt;a href=&quot;https://github.com/agoncal/agoncal-fascicle-quarkus-pract&quot;&gt;un super exemple r√©alis√© par Antonio Concalves&lt;/a&gt;. Ce projet d√©montre les capacit√©s de Quarkus sur les sujets suivants:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Circuit Breaker&lt;/li&gt;
  &lt;li&gt;Observabilit√©&lt;/li&gt;
  &lt;li&gt;OpenTracing&lt;/li&gt;
  &lt;li&gt;Tests&lt;/li&gt;
  &lt;li&gt;‚Ä¶&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Et la on peut se demander quid de &lt;a href=&quot;http://spring.io/&quot;&gt;Spring&lt;/a&gt;? Je me doutais que ces fonctionnalit√©s √©taient soient disponibles par d√©faut soient facilement int√©grables vu la richesse de l‚Äô√©cosyst√®me.&lt;/p&gt;

&lt;p&gt;J‚Äôai donc r√©alis√© un clone de &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring&quot;&gt;ce projet bas√© sur Spring Boot/Cloud&lt;/a&gt;. Je ne vais pas d√©tailler plus que √ßa les diff√©rentes fonctionnalit√©s, vous pouvez vous r√©f√©rer au fichier &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring#readme&quot;&gt;README&lt;/a&gt;. Il est suffisamment d√©taill√© pour que vous puissiez ex√©cuter et les mettre en ≈ìuvre.&lt;/p&gt;

&lt;h2 id=&quot;architecture-de-lapplication&quot;&gt;Architecture de l‚Äôapplication&lt;/h2&gt;

&lt;p&gt;Vous trouverez ci-dessous un sch√©ma d‚Äôarchitecture de l‚Äôapplication &lt;a href=&quot;https://c4model.com/&quot;&gt;au format C4&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/07/rest-book-architecture.png&quot; alt=&quot;maintenance&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;circuit-breaker&quot;&gt;Circuit Breaker&lt;/h2&gt;

&lt;p&gt;Lors des appels entre le &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring/blob/main/rest-book/src/main/java/info/touret/bookstore/spring/book/service/BookService.java&quot;&gt;bookstore&lt;/a&gt; et le &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring/blob/main/rest-number/src/main/java/info/touret/bookstore/spring/number/controller/BookNumbersController.java&quot;&gt;booknumberservice&lt;/a&gt;, il peut √™tre int√©ressant d‚Äô impl√©menter un &lt;a href=&quot;https://martinfowler.com/bliki/CircuitBreaker.html&quot;&gt;circuit breaker&lt;/a&gt; pour pallier aux indisponibilit√©s de ce dernier.&lt;br /&gt;
Avec Spring, on peut utiliser &lt;a href=&quot;https://github.com/resilience4j/resilience4j&quot;&gt;Resilience4J&lt;/a&gt; au travers de &lt;a href=&quot;https://spring.io/projects/spring-cloud&quot;&gt;Spring Cloud&lt;/a&gt;. Tout ceci se fait de mani√®re programmatique&lt;/p&gt;

&lt;p&gt;Il faut tout d‚Äôabord &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring/blob/main/rest-book/src/main/java/info/touret/bookstore/spring/book/BookConfiguration.java&quot;&gt;configurer les circuit breakers au travers d‚Äôune classe Configuration&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Customizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Resilience4JCircuitBreakerFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createDefaultCustomizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;configureDefault&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Resilience4JConfigBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;timeLimiterConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;TimeLimiterConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;timeoutDuration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeoutInSec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;circuitBreakerConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CircuitBreakerConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ofDefaults&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * Creates a circuit breaker customizer applying a timeout specified by the &amp;lt;code&amp;gt;booknumbers.api.timeout_sec&amp;lt;/code&amp;gt; property.
     * This customizer could be reached using this id: &amp;lt;code&amp;gt;slowNumbers&amp;lt;/code&amp;gt;
     * @return the circuit breaker customizer to apply when calling to numbers api
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Customizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Resilience4JCircuitBreakerFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createSlowNumbersAPICallCustomizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;circuitBreakerConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CircuitBreakerConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ofDefaults&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;timeLimiterConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;TimeLimiterConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;custom&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;timeoutDuration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeoutInSec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()),&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;slowNumbers&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Gr√¢ce √† ces instanciations, on r√©f√©rence les diff√©rents &lt;a href=&quot;https://martinfowler.com/bliki/CircuitBreaker.html&quot;&gt;circuit breakers&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Maintenant, on peut les utiliser dans le code de la mani√®re suivante:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Book&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;registerBook&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@Valid&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Book&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;circuitBreakerFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;slowNumbers&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;persistBook&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;throwable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fallbackPersistBook&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bookRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;book&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maintenant, il ne reste plus qu‚Äô√† cr√©er &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring/blob/main/rest-book/src/main/java/info/touret/bookstore/spring/book/service/BookService.java&quot;&gt;une m√©thode de ¬´¬†fallback¬†¬ª utilis√©e si un service est indisponible&lt;/a&gt;. Cette derni√®re nous permettra, par exemple, de mettre le payload dans un fichier pour futur traitement batch.&lt;/p&gt;

&lt;h2 id=&quot;observabilit√©&quot;&gt;Observabilit√©&lt;/h2&gt;

&lt;p&gt;L‚Äôobservabilit√© est sans contexte la pierre angulaire (oui, rien que √ßa‚Ä¶) de toute application cloud native. Sans √ßa, pas de scalabilit√©, de red√©marrage automatique,etc.&lt;br /&gt;
Les architectures de ce type d‚Äôapplications sont &lt;a href=&quot;https://en.wikipedia.org/wiki/Idempotence&quot;&gt;idempotentes&lt;/a&gt;. On a donc besoin d‚Äôavoir toutes les informations √† notre disposition. Heureusement, &lt;a href=&quot;https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#actuator&quot;&gt;Spring fournit par le biais d‚Äô Actuator&lt;/a&gt; toutes les informations n√©cessaires. Ces derni√®res pourront soit √™tre utilis√©es par &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; (ex. le &lt;a href=&quot;https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/&quot;&gt;livenessProbe&lt;/a&gt;) ou agr√©g√©es dans une base de donn√©es &lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/storage/&quot;&gt;Prometheus&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pour activer certaines m√©triques d‚Äô&lt;a href=&quot;https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html&quot;&gt;actuator&lt;/a&gt;, il suffit de :&lt;/p&gt;

&lt;p&gt;Ajouter la/les d√©pendance(s)&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[...]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;implementation&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'org.springframework.boot:spring-boot-starter-actuator'&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;implementation&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'io.micrometer:micrometer-registry-prometheus'&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;[...]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sp√©cifier la configuration ad√©quate:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;management:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;endpoints:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;web:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;exposure:&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;include:&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'*'&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;jmx:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;exposure:&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;include:&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'*'&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;endpoint:&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;health:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;details:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;always&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;probes:&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;shutdown:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;prometheus:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;metrics:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;health:&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;livenessstate:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;readinessstate:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;datasource:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;metrics:&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;web:&lt;/span&gt;
      &lt;span class=&quot;nl&quot;&gt;client:&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;request:&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;autotime:&lt;/span&gt;
            &lt;span class=&quot;nl&quot;&gt;enabled:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;opentracing&quot;&gt;OpenTracing&lt;/h2&gt;

&lt;p&gt;Sur les applications distribu√©es, il peut s‚Äôav√©rer compliqu√© de concentrer les logs et de les corr√©ler. Certes, avec un ID de corr√©lation, on peut avoir certaines informations. Cependant, il faut que les logs soient bien positionn√©es dans le code. On peut √©galement passer √† travers de certaines informations (ex. connexion aux bases de donn√©es, temps d‚Äôex√©cution des APIS,‚Ä¶). Je ne vous parle pas des soucis de volum√©trie engendr√©es par des index Elasticsearch/Splunk sur des applications √† forte volum√©trie.&lt;/p&gt;

&lt;p&gt;Depuis quelques temps, le &lt;a href=&quot;https://www.cncf.io/&quot;&gt;CNCF&lt;/a&gt; propose un projet (encore en incubation) : &lt;a href=&quot;https://opentracing.io/&quot;&gt;OpenTracing&lt;/a&gt;. Ce dernier fait d√©sormais partie d‚Äô&lt;a href=&quot;https://opentelemetry.io/&quot;&gt;OpenTelemetry&lt;/a&gt;.&lt;br /&gt;
Gr√¢ce √† cet librairie, nous allons pouvoir tracer toutes les transactions de notre application microservices et pouvoir r√©aliser une corr√©lation ¬´¬†out of the box¬†¬ª gr√¢ce √† l‚Äôint√©gration avec &lt;a href=&quot;https://www.jaegertracing.io/&quot;&gt;Jaeger&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pour activer la fonctionnalit√© il suffit d‚Äôajouter la d√©pendance au classpath:&lt;/p&gt;

&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;implementation&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'io.opentracing.contrib:opentracing-spring-jaeger-cloud-starter:3.3.1'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;et de configurer l‚ÄôURL de Jaeger dans l‚Äôapplication&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;# Default values&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;opentracing&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;jaeger&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;udp-sender&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;localhost&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6831&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Une fois l‚Äôapplication reconstruite et red√©marr√©e, vous pourrez visualiser les transactions dans JAEGER:&lt;figure class=&quot;wp-block-gallery columns-2 is-cropped&quot;&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/07/screenshot-2021-07-26-at-11-38-31-jaeger-ui-1568x532.png&quot; alt=&quot;jaeger1&quot; /&gt;
&lt;img src=&quot;/assets/images/2021/07/screenshot-2021-07-26-at-11-38-15-jaeger-ui-1568x759.png&quot; alt=&quot;jaeger2&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Je ne vais pas exposer l‚Äôimpl√©mentation des tests unitaires et d‚Äôint√©gration. Si vous voulez voir comment j‚Äôai r√©ussi √† mocker simplement les appels REST √† une API distante, vous pouvez regarder &lt;a href=&quot;https://github.com/alexandre-touret/bookstore_spring/blob/main/rest-book/src/test/java/info/touret/bookstore/spring/book/controller/BookControllerIT.java&quot;&gt;cette classe&lt;/a&gt; pour voir une utilisation du &lt;a href=&quot;https://www.baeldung.com/mockserver&quot;&gt;MockServer&lt;/a&gt;.&lt;br /&gt;
Aussi, n‚Äôh√©sitez pas √† cloner, tester ce projet et me donner votre retour. J‚Äôessaierai de le mettre √† jour au fur et √† mesure de mes d√©couvertes (par ex. OpenTelemetry).&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="github" /><category term="java" /><category term="observability" /><category term="planetlibre" /><category term="spring" /><summary type="html">Il y a quelques mois d√©j√†, je discutais avec un coll√®gue d‚Äô observabilit√©, opentracing, ‚Ä¶ avec Quarkus. On est tomb√© sur un super exemple r√©alis√© par Antonio Concalves. Ce projet d√©montre les capacit√©s de Quarkus sur les sujets suivants:</summary></entry><entry><title type="html">Ajouter un mode ¬´¬†maintenance¬†¬ª √† votre API gr√¢ce √† Spring boot</title><link href="https://blog.touret.info/2021/06/10/ajouter-un-mode-maintenance-a-votre-api-grace-a-spring-boot/" rel="alternate" type="text/html" title="Ajouter un mode ¬´¬†maintenance¬†¬ª √† votre API gr√¢ce √† Spring boot" /><published>2021-06-10T15:01:20+00:00</published><updated>2021-06-10T15:01:20+00:00</updated><id>https://blog.touret.info/2021/06/10/ajouter-un-mode-maintenance-a-votre-api-grace-a-spring-boot</id><content type="html" xml:base="https://blog.touret.info/2021/06/10/ajouter-un-mode-maintenance-a-votre-api-grace-a-spring-boot/">&lt;p&gt;&lt;img src=&quot;/assets/images/2021/06/pexels-photo-257736.jpeg&quot; alt=&quot;maintenance&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Quand vous avez une API, et a fortiori une application, il peut √™tre parfois n√©cessaire de passer l‚Äôapplication en mode ¬´¬†maintenance¬†¬ª.&lt;br /&gt;Pour certaines applications il est parfois inutile de le traiter au niveau applicatif, car √ßa peut √™tre pris g√©r√© par certaines couches de s√©curit√© ou frontaux web par ex. (&lt;a href=&quot;https://httpd.apache.org/&quot;&gt;Apache HTTPD&lt;/a&gt;, &lt;a href=&quot;https://fr.wikipedia.org/wiki/Web_application_firewall&quot;&gt;WAF&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/fr/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/&quot;&gt;Kubernetes a introduit ( ou popularis√© ) les notions de ¬´¬†probes¬†¬ª&lt;/a&gt; et plus particuli√®rement les &lt;a href=&quot;https://kubernetes.io/fr/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/&quot;&gt;livenessProbes&lt;/a&gt; et &lt;a href=&quot;https://kubernetes.io/fr/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/&quot;&gt;readinessProbes&lt;/a&gt;.&lt;br /&gt;
Le premier nous indique si l‚Äôapplication est en √©tat de fonctionnement, le second nous permet de savoir si cette derni√®re est apte √† recevoir des requ√™tes (ex. lors d‚Äôun d√©marrage).&lt;/p&gt;

&lt;p&gt;Je vais exposer dans cet article comment utiliser au mieux ces probes et &lt;a href=&quot;https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/&quot;&gt;les APIs SPRING&lt;/a&gt; pour int√©grer dans une API un mode ¬´¬†maintenance¬†¬ª&lt;/p&gt;

&lt;h2 id=&quot;stack-utilis√©e&quot;&gt;Stack utilis√©e&lt;/h2&gt;

&lt;p&gt;Dans l‚Äôexemple que j‚Äôai d√©velopp√©, j‚Äôai pu utiliser les briques suivantes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OpenJDK 11.0.10&lt;/li&gt;
  &lt;li&gt;Spring Boot 2.5.0 (web, actuator)&lt;/li&gt;
  &lt;li&gt;Maven 3.8.1&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Bref, rien de neuf √† l‚Äôhorizon üôÇ&lt;/p&gt;

&lt;h2 id=&quot;configuration-de-spring-actuator&quot;&gt;Configuration de Spring Actuator&lt;/h2&gt;

&lt;p&gt;Pour activer les diff√©rents probes, vous devez activer &lt;a href=&quot;https://docs.spring.io/spring-boot/docs/2.4.0/actuator-api/&quot;&gt;Actuator&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Dans le fichier pom.xml, vous devez ajouter le starter correspondant:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;nt&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;nt&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-boot-starter-actuator&lt;span class=&quot;nt&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Puis vous devez d√©clarer ces differentes &lt;a href=&quot;https://github.com/alexandre-touret/maintenance-mode/blob/main/src/main/resources/application.properties&quot;&gt;propri√©t√©s&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-ini highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;py&quot;&gt;management.endpoints.enabled-by-default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;management.health.livenessstate.enabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;management.health.readinessstate.enabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;management.endpoint.health.show-details&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;management.endpoint.health.probes.enabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;py&quot;&gt;management.endpoint.health.enabled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Apr√®s avoir red√©marr√© votre application, vous pourrez conna√Ætre son statut gr√¢ce √† un appel HTTP&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; http://localhost:8080/actuator/health/readiness 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;comment-r√©cup√©rer-le-statut-des-probes&quot;&gt;Comment r√©cup√©rer le statut des probes?&lt;/h2&gt;

&lt;p&gt;Avec Spring, vous pouvez modifier les diff√©rents statuts avec les classes &lt;a href=&quot;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/ApplicationEventPublisher.html&quot;&gt;ApplicationEventPublisher&lt;/a&gt; et &lt;a href=&quot;https://docs.spring.io/spring-boot/docs/2.4.4/api/org/springframework/boot/availability/ApplicationAvailability.html&quot;&gt;ApplicationAvailability&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Par exemple, pour conna√Ætre le statut &lt;a href=&quot;https://docs.spring.io/spring-boot/docs/2.5.0-SNAPSHOT/api/org/springframework/boot/availability/ReadinessState.html&quot;&gt;Readiness&lt;/a&gt; vous pouvez ex√©cuter le code suivant:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@ApiResponses&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;nd&quot;&gt;@ApiResponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;responseCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;200&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Checks if the application in under maitenance&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)})&lt;/span&gt;
 &lt;span class=&quot;nd&quot;&gt;@GetMapping&lt;/span&gt;
 &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;MaintenanceDTO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;retreiveInMaintenance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lastChangeEvent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;availability&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getLastChangeEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ReadinessState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MaintenanceDTO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lastChangeEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ReadinessState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;REFUSING_TRAFFIC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lastChangeEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getTimestamp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())));&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Et la modification ?&lt;/p&gt;

&lt;p&gt;Gr√¢ce √† la m√™me API, on peut √©galement modifier ce statut dans via du code:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@ApiResponses&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@ApiResponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;responseCode&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;204&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Put the app under maitenance&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)})&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@PutMapping&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initInMaintenance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@NotNull&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@RequestBody&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;inMaintenance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;AvailabilityChangeEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eventPublisher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;valueOf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inMaintenance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ReadinessState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;REFUSING_TRAFFIC&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ReadinessState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACCEPTING_TRAFFIC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ResponseEntity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;noContent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;filtre-les-appels-et-indiquer-que-lapplication-est-en-maintenance&quot;&gt;Filtre les appels et indiquer que l‚Äôapplication est en maintenance&lt;/h2&gt;

&lt;p&gt;Maintenant qu‚Äôon a cod√© les m√©canismes de r√©cup√©ration du statut de l‚Äôapplication et de la mise en maintenance, on peut ajouter le m√©canisme permettant de traiter ou non les appels entrants.&lt;br /&gt;
Pour √ßa on va utiliser un &lt;a href=&quot;http://blog.paumard.org/cours/servlet/chap04-filtre-mise-en-place.html&quot;&gt;bon vieux filtre servlet&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Ce dernier aura la t√¢che de laisser passer les requ√™tes entrantes si l‚Äôapplication n‚Äôest pas en maintenance et de d√©clencher une &lt;a href=&quot;https://github.com/alexandre-touret/maintenance-mode/blob/main/src/main/java/info/touret/spring/maintenancemode/exception/MaintenanceException.java&quot;&gt;MaintenanceException&lt;/a&gt; le cas √©ch√©ant qui sera trait√© par &lt;a href=&quot;https://github.com/alexandre-touret/maintenance-mode/blob/main/src/main/java/info/touret/spring/maintenancemode/GlobalExceptionHandler.java&quot;&gt;la gestion d‚Äôerreur globale de l‚Äôapplication&lt;/a&gt; ( trait√© via un &lt;a href=&quot;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RestControllerAdvice.html&quot;&gt;@RestControllerAdvice&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Pour que l‚Äôexception soit bien trait√©e par ce m√©canisme, il faut le d√©clencher via le &lt;a href=&quot;https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/HandlerExceptionResolver.html&quot;&gt;HandlerExceptionResolver&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Component&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CheckMaintenanceFilter&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Filter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Logger&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;LOGGER&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;LoggerFactory&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getLogger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;CheckMaintenanceFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ApplicationAvailability&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;availability&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Qualifier&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;handlerExceptionResolver&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;HandlerExceptionResolver&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exceptionHandler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * Checks if the application is under maintenance. If it is and if the requested URI is not '/api/maintenance', it throws a &amp;lt;code&amp;gt;MaintenanceException&amp;lt;/code&amp;gt;
     *
     * @param request
     * @param response
     * @param chain
     * @throws IOException
     * @throws ServletException
     * @throws info.touret.spring.maintenancemode.exception.MaintenanceException the application is under maintenance
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ServletRequest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServletResponse&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FilterChain&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;IOException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServletException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;availability&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getReadinessState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ReadinessState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;REFUSING_TRAFFIC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;!((&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpServletRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRequestURI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;API_MAINTENANCE_URI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;no&quot;&gt;LOGGER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Message handled during maintenance [{}]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpServletRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRequestURI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;exceptionHandler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;resolveException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpServletRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpServletResponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MaintenanceException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Service currently in maintenance&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;doFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enfin, voici la gestion des erreurs de l‚ÄôAPI:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@RestControllerAdvice&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;GlobalExceptionHandler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * Indicates that the application is on maintenance
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@ResponseStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;I_AM_A_TEAPOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@ExceptionHandler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;MaintenanceException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;APIError&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;maintenance&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;APIError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;I_AM_A_TEAPOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Service currently in maintenance&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/**
     * Any other exception
     */&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@ResponseStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;INTERNAL_SERVER_ERROR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@ExceptionHandler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;RuntimeException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;APIError&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;anyException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;APIError&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;INTERNAL_SERVER_ERROR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;An unexpected server error occured&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;On a pu voir comment int√©ragir simplement avec les APIS SPRING pour g√©rer le statut de l‚Äôapplication pour r√©pondre √† cette question :Est-elle disponible ou non?&lt;br /&gt;
Bien √©videmment, selon le contexte, il conviendra d‚Äôajouter un peu de s√©curit√© pour que cette API ne soit pas disponible √† tout le monde üôÇ&lt;/p&gt;

&lt;p&gt;Le code expos√© ici est disponible sur &lt;a href=&quot;https://github.com/alexandre-touret/maintenance-mode/&quot;&gt;Github&lt;/a&gt;. Le &lt;a href=&quot;https://github.com/alexandre-touret/maintenance-mode/blob/main/README.md&quot;&gt;Readme&lt;/a&gt; est suffisamment d√©taill√© pour que vous puissiez tester et r√©utiliser le code.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="actuator" /><category term="observability" /><category term="planetlibre" /><category term="spring" /><category term="springboot" /><summary type="html"></summary></entry><entry><title type="html">Utiliser GPG dans WSL2</title><link href="https://blog.touret.info/2021/05/03/utiliser-gpg-dans-wsl2/" rel="alternate" type="text/html" title="Utiliser GPG dans WSL2" /><published>2021-05-03T18:47:11+00:00</published><updated>2021-05-03T18:47:11+00:00</updated><id>https://blog.touret.info/2021/05/03/utiliser-gpg-dans-wsl2</id><content type="html" xml:base="https://blog.touret.info/2021/05/03/utiliser-gpg-dans-wsl2/">&lt;p&gt;&lt;img src=&quot;/assets/images/2021/05/pexels-photo-261621.jpeg&quot; alt=&quot;pexel photo&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pourquoi utiliser &lt;a href=&quot;https://fr.wikipedia.org/wiki/GNU_Privacy_Guard&quot;&gt;GPG&lt;/a&gt; ? Par exemple &lt;a href=&quot;https://blog.touret.info/2019/08/09/verifier-les-commit-git-avec-gpg/&quot;&gt;pour signer les commits GIT&lt;/a&gt;. Maintenant comment faire quand on est sous Windows 10 et qu‚Äôon souhaite utiliser &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/wsl/install-win10&quot;&gt;le sous syst√®me Linux (WSL2)&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Sous GNU/Linux, l‚Äôinstallation et l‚Äôutilisation avec git est tr√®s simple. Avec &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/wsl/install-win10&quot;&gt;WSL2&lt;/a&gt;,‚Ä¶ il faut un peu d‚Äôhuile de coude üôÇ&lt;/p&gt;

&lt;p&gt;Je vais t√¢cher de d√©crire dans cet article les diff√©rentes manipulations n√©cessaires pour:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Importer une cl√© GPG existante&lt;/li&gt;
  &lt;li&gt;Utiliser GPG pour signer mes commits dans WSL2&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;importer-une-cl√©-gpg-existante&quot;&gt;Importer une cl√© GPG existante&lt;/h2&gt;

&lt;h3 id=&quot;export-de-la-cl√©-gpg&quot;&gt;Export de la cl√© GPG&lt;/h3&gt;

&lt;h4 id=&quot;identifier-l-id-de-la-cl√©&quot;&gt;Identifier l‚Äô ID de la cl√©&lt;/h4&gt;

&lt;p&gt;Lancez la commande suivante:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gpg &lt;span class=&quot;nt&quot;&gt;--export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; public.key
gpg &lt;span class=&quot;nt&quot;&gt;--export-secret-key&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ID&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; private.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;import&quot;&gt;Import&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gpg &lt;span class=&quot;nt&quot;&gt;--import&lt;/span&gt; public.key
gpg &lt;span class=&quot;nt&quot;&gt;--import&lt;/span&gt; private.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;v√©rification&quot;&gt;V√©rification&lt;/h3&gt;

&lt;p&gt;Pour v√©rifier que la cl√© est bien configur√©e, vous pouvez lancer la commande suivante:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gpg &lt;span class=&quot;nt&quot;&gt;--list-secret-keys&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--keyid-format&lt;/span&gt; LONG   alexandre@....
sec   rsa4096/CLE_ID 2019-12-20 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;SC]
      &lt;span class=&quot;k&quot;&gt;********************&lt;/span&gt;
uid                &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;  ultime &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Alexandre &amp;lt;alexandre@....&amp;gt;
ssb   rsa4096/SUB 2019-12-20 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si la cl√© n‚Äôest pas reconnue comme ultime ou comme de confiance, il faudra l‚Äô√©diter:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gpg &lt;span class=&quot;nt&quot;&gt;--edit-key&lt;/span&gt; CLE_ID
Please decide how far you trust this user to correctly verify other &lt;span class=&quot;nb&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;' keys
(by looking at passports, checking fingerprints from different sources, etc.)
  1 = I don'&lt;/span&gt;t know or won&lt;span class=&quot;s1&quot;&gt;'t say
  2 = I do NOT trust
  3 = I trust marginally
  4 = I trust fully
  5 = I trust ultimately
  m = back to the main menu
Your decision? 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si vous ne voulez pas trop vous compliquer, je vous conseille de r√©pondre &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;configuration-gpg-pour-wsl2&quot;&gt;Configuration GPG pour WSL2&lt;/h2&gt;

&lt;p&gt;Avant de configurer l‚Äôagent GPG, vous pouvez vous r√©f√©rer &lt;a href=&quot;https://blog.touret.info/2019/08/09/verifier-les-commit-git-avec-gpg/&quot;&gt;√† cet article&lt;/a&gt; pour configurer GIT et GPG. La configuration est √©quivalente.&lt;/p&gt;

&lt;p&gt;Ensuite, cr√©ez le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.gnupg/gpg.conf&lt;/code&gt; avec le contenu suivant:&lt;/p&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Uncomment within config (or add this line)
# This tells gpg to use the gpg-agent
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;use&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Set the default key
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CLE_ID&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Puis cr√©ez le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.gnupg/gpg-agent.conf&lt;/code&gt; avec le contenu ci-dessous:&lt;/p&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;cache&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;ttl&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;34560000&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;cache&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;ttl&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;34560000&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pinentry&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;program&lt;/span&gt; /&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;pinentry&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;curses&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Le cache ici est d√©fini en secondes. Il est mis ici √† 400 jours.&lt;/p&gt;

&lt;p&gt;Ce dernier fichier fait r√©f√©rence au programme &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pinentry&lt;/code&gt;. Vous pouvez v√©rifier sa pr√©sence gr√¢ce √† la commande:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; /usr/bin/pinentry-curses 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Si vous ne l‚Äôavez pas, vous pouvez l‚Äôinstaller gr√¢ce √† la commande suivante:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;pinentry-curses
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maintenant, on peut configurer l‚Äôenvironnement BASH en modifiant le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.bashrc&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# enable GPG signing&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GPG_TTY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tty&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; ~/.gnupg/S.gpg-agent &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt; gpg-agent &lt;span class=&quot;nt&quot;&gt;--daemon&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--options&lt;/span&gt; ~/.gnupg/gpg-agent.conf &lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;fi
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;GPG_AGENT_INFO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HOME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/.gnupg/S.gpg-agent:0:1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Red√©marrez ensuite WSL2 pour que √ßa soit pris en compte.&lt;/p&gt;

&lt;p&gt;A la premi√®re utilisation de GPG ( par ex. lors d‚Äôun commit, vous aurez une interface &lt;a href=&quot;https://fr.wikipedia.org/wiki/Ncurses&quot;&gt;Ncurses&lt;/a&gt; qui appara√Ætra dans votre prompt WSL2. Vous aurez √† renseigner le mot de passe de votre cl√©.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="git" /><category term="gpg" /><category term="planetlibre" /><category term="wsl2" /><summary type="html"></summary></entry><entry><title type="html">Installer Ubuntu 20.04 LTS sur un DELL Inspiron 13 5000</title><link href="https://blog.touret.info/2021/04/02/installer-ubuntu-20-04-lts-sur-un-dell-inspiron-13-5000/" rel="alternate" type="text/html" title="Installer Ubuntu 20.04 LTS sur un DELL Inspiron 13 5000" /><published>2021-04-02T19:45:43+00:00</published><updated>2021-04-02T19:45:43+00:00</updated><id>https://blog.touret.info/2021/04/02/installer-ubuntu-20-04-lts-sur-un-dell-inspiron-13-5000</id><content type="html" xml:base="https://blog.touret.info/2021/04/02/installer-ubuntu-20-04-lts-sur-un-dell-inspiron-13-5000/">&lt;p&gt;&lt;a href=&quot;https://blog.touret.info/2020/03/23/installer-ubuntu-18-04-lts-sur-un-dell-inspiron-14-3493/&quot;&gt;Les confinements se suivent et se ressemblent&lt;/a&gt;. Me voil√† √† installer Ubuntu sur un nouvel ordinateur.&lt;/p&gt;

&lt;p&gt;A l‚Äôinstar de l‚Äôancien laptop que j‚Äôai achet√© pour mon a√Æn√©e, j‚Äôai achet√© un DELL pour ma deuxi√®me fille.J‚Äôai opt√© pour un DELL Inspiron 5301.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/04/dell-inspiron-13-5301-argent-01.jpg&quot; alt=&quot;dell inspiron&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A l‚Äôinstar de mon autre laptop, je j‚Äôai pas pris de risques. J‚Äôai opt√© pour un DELL qui est pleinement compatible avec Ubuntu. Oui j‚Äôaurai pu installer un ordinateur avec Ubuntu pr√©-install√©, mais je n‚Äôai pas eu le temps de faire un choix ¬´¬†serein¬†¬ª.&lt;/p&gt;

&lt;h2 id=&quot;configuration-du-bios&quot;&gt;Configuration du BIOS&lt;/h2&gt;

&lt;p&gt;Voila les param√®tres que j‚Äôai appliqu√©:&lt;/p&gt;

&lt;p&gt;Dans le menu &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;Storage&quot;&lt;/code&gt; puis &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;SATA Operation&quot;&lt;/code&gt;: vous devez s√©lectionner AHCI au lieu de RAID.&lt;br /&gt;
Dans le menu &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&quot;Change boot mode settings &amp;gt;UEFI Boot Mode&quot;&lt;/code&gt; , vous devez d√©sactiver le &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Secure Boot&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Une fois r√©alis√©, vous pouvez red√©marrer en appuyant sur la touche F12. Si vous n‚Äôarrivez pas √† revenir sur le BIOS pour indiquer de booter sur votre cl√© USB, vous obtiendrez un √©cran d‚Äôerreur Windows d√ª √† la configuration AHCI. Personnellement, en red√©marrant une ou deux fois, j‚Äôai obtenu un √©cran de d√©marrage avanc√© qui m‚Äôa permis de s√©lectionner le p√©riph√©rique (ma cl√© USB) sur lequel d√©marrer.&lt;/p&gt;

&lt;p&gt;Maintenant vous pouvez acc√©der √† l‚Äôinstalleur Ubuntu et profiter.&lt;/p&gt;

&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;/h2&gt;

&lt;p&gt;J‚Äôai eu plusieurs fois des popup ¬´¬†erreur rencontr√©¬†¬ª. Ce n‚Äô√©tait pas bloquant. J‚Äôai continu√©.&lt;/p&gt;

&lt;p&gt;Tout s‚Äôest d√©roul√© sans encombre. &lt;a href=&quot;https://certification.ubuntu.com/hardware/202007-28039&quot;&gt;Le mat√©riel est tr√®s bien reconnu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Les seuls logiciels que j‚Äôai install√© sont pour l‚Äôinstant : VLC, Minecraft ( obligatoire dans la famille ) et Chromium.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="dell" /><category term="planetlibre" /><category term="ubuntu" /><summary type="html">Les confinements se suivent et se ressemblent. Me voil√† √† installer Ubuntu sur un nouvel ordinateur.</summary></entry><entry><title type="html">G√©rer ¬´¬†efficacement¬†¬ª les fichiers de configuration dans les charts HELM</title><link href="https://blog.touret.info/2021/01/09/gerer-efficacement-les-fichiers-de-configuration-dans-les-charts-helm/" rel="alternate" type="text/html" title="G√©rer ¬´¬†efficacement¬†¬ª les fichiers de configuration dans les charts HELM" /><published>2021-01-09T14:21:28+00:00</published><updated>2021-01-09T14:21:28+00:00</updated><id>https://blog.touret.info/2021/01/09/gerer-efficacement-les-fichiers-de-configuration-dans-les-charts-helm</id><content type="html" xml:base="https://blog.touret.info/2021/01/09/gerer-efficacement-les-fichiers-de-configuration-dans-les-charts-helm/">&lt;p class=&quot;has-drop-cap&quot;&gt;
  D√®s qu'on veut d√©ployer des environnements &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt;, &lt;a href=&quot;https://helm.sh/&quot;&gt;Helm &lt;/a&gt;devient une des solutions √† consid√©rer.&lt;br /&gt;Le d√©ploiement des objets standards tels que &lt;code&gt;deployment&lt;/code&gt;, &lt;code&gt;autoscaler &lt;/code&gt;et autres se fait ais√©ment car ces derniers ne changent pas d'un environnement √† l'autre. G√©n√©ralement on d√©ploie la m√™me infrastructure sur tous les environnements du d√©veloppement √† la production.
&lt;/p&gt;

&lt;p&gt;Bien √©videmment on pourra limiter la taille des replicas sur l‚Äôenvironnement de d√©veloppement par exemple mais au fond, le contenu des charts sera identique. Une des difficult√©s que l‚Äôon pourra rencontrer c‚Äôest dans la gestion des fichiers de configuration.&lt;/p&gt;

&lt;p&gt;Je vais essayer d‚Äôexposer dans cet article comment j‚Äôai r√©ussi √† g√©rer +/- efficacement (en tout cas pour moi) les fichiers de configuration dans les charts HELM.&lt;figure class=&quot;wp-block-gallery columns-1 is-cropped&quot;&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2021/01/loik-marras-sq0l3spwlhi-unsplash.jpg&quot; alt=&quot;helm&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;les-config-maps-et-secrets&quot;&gt;Les config maps et secrets&lt;/h2&gt;

&lt;p&gt;Logiquement dans ce type d‚Äôarchitecture, les &lt;a href=&quot;https://kubernetes.io/docs/concepts/configuration/configmap/&quot;&gt;configmaps&lt;/a&gt; et &lt;a href=&quot;https://kubernetes.io/docs/concepts/configuration/secret/&quot;&gt;secrets&lt;/a&gt; permettent le chargement des variables d‚Äôenvironnement et autres mots de passe. Cependant si vous utilisez certains frameworks qui n√©cessitent des fichiers de configuration, vous devrez charger les fichiers dans des volumes. Pour ces derniers, les volumes n‚Äôont pas besoin d‚Äô√™tre persistents.&lt;/p&gt;

&lt;p&gt;Par exemple dans la configuration de votre &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;deployment&lt;/code&gt;, vous pourrez configurer le montage d‚Äôun volume de la mani√®re suivante:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/config&lt;/span&gt;
              &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;configuration-volume&lt;/span&gt;
              &lt;span class=&quot;na&quot;&gt;readOnly&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
            &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/secrets&lt;/span&gt;
              &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;secret-volume&lt;/span&gt;
              &lt;span class=&quot;na&quot;&gt;readOnly&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;configMap&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;defaultMode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;420&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;configuration&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;configuration-volume&lt;/span&gt;
        &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;secret-volume&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;defaultMode&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;420&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;secretName&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;secrets&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour int√©grer un fichier binaire, on pourra le faire de la mani√®re suivante dans le template HELM:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Definition of secrets&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Secret&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Opaque&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Inclusion of binary configuration files&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;my_keystore_jks  .Files.Get &quot;secrets/my_keystore.jks&quot; | b64enc }}&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Vous pouvez d√©finir les fichiers directement dans vos configmaps. Cependant, si vos fichiers sont volumineux, vous aurez du mal √† les maintenir. Personnellement, j‚Äôopte pour mettre les fichiers de configuration √† cot√© et les charger dans le configmap.&lt;/p&gt;

&lt;p&gt;On pourra proc√©der de la mani√®re suivante:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ConfigMap&lt;/span&gt;
&lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;my_conf&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;   &lt;span class=&quot;pi&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;- (.Files.Glob &quot;conf/*&quot;).AsConfig | nindent 2&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;}}&lt;/span&gt; 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;livrables-agnostiques&quot;&gt;Livrables agnostiques&lt;/h2&gt;

&lt;p&gt;Une bonne pratique de d√©veloppement logiciel est d‚Äôexternaliser la configuration de vos environnements (ex. l‚ÄôURL JDBC de la base de donn√©es) des livrables. Les charts HELM n‚Äô√©chappent √† la r√®gle.&lt;/p&gt;

&lt;p&gt;On peut stocker la configuration de chaque environnement dans le chart, mais dans ce cas, on perdra beaucoup de souplesse lors des mises √† jour des propri√©t√©s et cela nous imposera une nouvelle version.&lt;/p&gt;

&lt;p&gt;On a plusieurs niveaux d‚Äôexternalisation. Le premier est dans le chart. Vous pouvez externaliser les diff√©rentes valeurs dans le fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;values.yml&lt;/code&gt;. Ci dessous un exemple avec un &lt;a href=&quot;https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/&quot;&gt;autoscaler&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;autoscaling/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;HorizontalPodAutoscaler&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;maxReplicas&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;pi&quot;&gt;{{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;.Values.myapp.maxReplicaCount&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;}}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;minReplicas&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;.Values.myapp.minReplicaCount }}&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;scaleTargetRef&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;apps/v1&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deployment&lt;/span&gt;
   &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;targetCPUUtilizationPercentage&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;s&quot;&gt;.Values.myapp.replicationThreesold }}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Les valeurs sont d√©crites comme suit:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;myapp&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;minReplicaCount&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;2&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;maxReplicaCount&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;6&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;replicationThreesold&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;80&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour externaliser les valeurs d‚Äôenvironnement, vous pourrez donc externaliser un autre fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;values.yml&lt;/code&gt; qui sera appliqu√© au d√©ploiement. Les valeurs de ce dernier surchargeront les valeurs d√©finies dans le chart.&lt;br /&gt;
Il est important de noter √©galement que les donn√©es pr√©sentes dans les fichiers de configuration (ex. fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;application.properties&lt;/code&gt;) peuvent √™tre ¬´¬†variabilis√©es¬†¬ª et surcharg√©es par le m√™me m√©canisme. Vous aurez √† utiliser la commande &lt;a href=&quot;https://helm.sh/docs/chart_template_guide/functions_and_pipelines/&quot;&gt;tpl&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ConfigMap&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;configuration&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;s&quot;&gt;application.properties&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; 
    &lt;span class=&quot;pi&quot;&gt;|-&lt;/span&gt; 
    &lt;span class=&quot;s&quot;&gt;{{ tpl (.Files.Get &quot;conf/application.properties&quot;) . | nindent 4}} &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Vous l‚Äôaurez compris, les charts HELM n‚Äô√©chappent pas aux r√®gles d√©j√† connues de gestion des environnements et des livrables. M√™me si il y a quelques subtilit√©s √† conna√Ætre pour int√©grer des fichiers de configuration par exemple, les grands principes restent les m√™mes.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><summary type="html">D√®s qu'on veut d√©ployer des environnements Kubernetes, Helm devient une des solutions √† consid√©rer.Le d√©ploiement des objets standards tels que deployment, autoscaler et autres se fait ais√©ment car ces derniers ne changent pas d'un environnement √† l'autre. G√©n√©ralement on d√©ploie la m√™me infrastructure sur tous les environnements du d√©veloppement √† la production.</summary></entry></feed>