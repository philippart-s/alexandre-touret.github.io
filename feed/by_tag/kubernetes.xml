<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.2">Jekyll</generator><link href="https://blog.touret.info/feed/by_tag/kubernetes.xml" rel="self" type="application/atom+xml" /><link href="https://blog.touret.info/" rel="alternate" type="text/html" /><updated>2022-07-09T17:05:11+00:00</updated><id>https://blog.touret.info/feed/by_tag/kubernetes.xml</id><title type="html">blog.touret.info</title><subtitle>Mon blog personnel. J'y expose mes derniers travaux et ma veille technologique. Au menu en vrac: Java, Kotlin, Maven, Docker, Cloud, Kubernetes, logiciels libres, Debian, Ubuntu, Gnu/Linux, des talks online et pr√©sentiels.</subtitle><author><name>Alexandre Touret</name></author><entry><title type="html">Faire des batchs ‚ÄúCloud Native‚Äù dans Kubernetes</title><link href="https://blog.touret.info/2022/05/17/cloud-native-batchs/" rel="alternate" type="text/html" title="Faire des batchs ‚ÄúCloud Native‚Äù dans Kubernetes" /><published>2022-05-17T08:00:00+00:00</published><updated>2022-05-17T08:00:00+00:00</updated><id>https://blog.touret.info/2022/05/17/cloud-native-batchs</id><content type="html" xml:base="https://blog.touret.info/2022/05/17/cloud-native-batchs/">&lt;p&gt;Quand on parle du Cloud et de Kubernetes, g√©n√©ralement on pense aux APIs.
Mais qu‚Äôen est-il des batchs?&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/05/pat-whelen-xSsWBa4rb6E-unsplash.webp&quot; alt=&quot;pat-whelen-xSsWBa4rb6E-unsplash.jpg &quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Oui, depuis plusieurs ann√©es, on pensait les √©radiquer, mais ils sont encore l√† et on en a encore besoin pour quelques ann√©es encore. 
Ils ont m√™me eu une deuxi√®me jeunesse avec le Big Data et l‚Äôexplosion des volum√©tries dans l‚ÄôIT.&lt;/p&gt;

&lt;p&gt;Je vais essayer de faire un tour d‚Äôhorizon dans cet article des batchs dans un environnement Cloud et plus particuli√®rement dans Kubernetes.&lt;/p&gt;

&lt;p&gt;Les exemples pr√©sent√©s dans cet article seront (sans doute) approfondis dans un second article et d‚Äôores et d√©j√† disponibles dans &lt;a href=&quot;https://github.com/alexandre-touret/k8s-batch&quot;&gt;mon GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-des-batchs-dans-le-cloud&quot;&gt;Pourquoi des batchs dans le Cloud?&lt;/h2&gt;

&lt;p&gt;A ce titre un peu provocateur, j‚Äôajouterais aussi &lt;em&gt;‚ÄúPourquoi des batchs dans Kubernetes ?‚Äù&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Oui, aujourd‚Äôhui encore,comme j‚Äôai pu l‚Äôindiquer pr√©c√©demment, on doit cr√©er des traitements batchs. A cot√© des APIs qui repr√©sentent le cas d‚Äôutilisation ‚Äústandard‚Äù du Cloud, on peut √©galement avoir √† traiter des fichiers volumineux allant de plusieurs centaines de Mo √† quelques Go.&lt;/p&gt;

&lt;p&gt;Parmi les cas d‚Äôutilisation qui n√©cessitent ce genre de traitement, on pourra avoir:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Les reprises de donn√©es (suite √† des erreurs ou lors d‚Äôune initialisation)&lt;/li&gt;
  &lt;li&gt;Traitement suite √† une r√©ception de fichiers (par ex. traitement de fichiers OPENDATA)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si vous √™tes d√©j√† pass√© sur le Cloud pour vos applications transactionnelles, vous vous poserez cette question: &lt;em&gt;Puis-je √©galement d√©ployer des batchs?&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;pourquoi-se-poser-cette-question&quot;&gt;Pourquoi se poser cette question?&lt;/h3&gt;

&lt;p&gt;Les r√©ponses sont multiples. 
Elles sont tout d‚Äôabord li√©es √† une rationalisation des environnements.
Vous avez votre application dans le cloud, votre base de donn√©es y est √©galement g√©r√©e pour √©viter la latence r√©seau.
Vous devez donc d√©ployer des traitements tiers au plus proche de celle-ci pour vous soustraire des m√™mes soucis.&lt;/p&gt;

&lt;p&gt;De plus, l‚Äô√©cosyst√®me li√© au cloud offre des technologies et pratiques qui rendent la vie plus simple (si, si, je vous assure) aux d√©veloppeurs et ops. 
Le d√©ploiement via &lt;a href=&quot;https://en.wikipedia.org/wiki/Infrastructure_as_code&quot;&gt;l‚ÄôInfra As Code&lt;/a&gt; est un bon exemple : Avoir toute l‚Äôinfrastructure li√©e aux traitements batchs et transactionnels versionn√©es et instantiables √† la demande est quelque chose dont on a du mal √† se passer!&lt;/p&gt;

&lt;h2 id=&quot;difficult√©s-par-rapport-aux-apis&quot;&gt;Difficult√©(s) par rapport aux APIs&lt;/h2&gt;

&lt;p&gt;Quand on d√©ploie une API dans le cloud, g√©n√©ralement tout va bien. 
On peut voir rapidement que cet environnement convient bien √† ce genre de traitements.&lt;/p&gt;

&lt;p&gt;Pour les batchs, c‚Äôest une autre affaire!
Selon les soci√©t√©s, il peut y avoir un fort historique et beaucoup plus d‚Äôexigences que pour les APIs. 
Ces derni√®res pourront √™tre li√©es aux performances, √† la qualit√© de service ou plus simplement √† l‚Äôutilisation.&lt;/p&gt;

&lt;p&gt;Il faut donc, √† l‚Äôinstar de toute architecture, d√©terminer quel sera l‚Äôenvironnement technique de ce type de traitement. 
Cette fois, on aura √† concilier performances, fichiers volumineux et reprises sur erreur.&lt;/p&gt;

&lt;h3 id=&quot;quelques-technologies&quot;&gt;Quelques technologies&lt;/h3&gt;

&lt;p&gt;On pourra retrouver dans notre future architecture les briques suivantes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Une passerelle de fichiers (File Gateway) pour permettre l‚Äôenvoi des fichiers de mani√®re s√©curis√©e&lt;/li&gt;
  &lt;li&gt;Un stockage objet pour la distribution de fichiers ou l‚Äôarchivage.&lt;/li&gt;
  &lt;li&gt;Les √©l√©ments n√©cessaires √† l‚ÄôAPI : bases de donn√©es, &lt;a href=&quot;https://en.wikipedia.org/wiki/Hardware_security_module&quot;&gt;HSMs&lt;/a&gt;, Cluster Kubernetes,‚Ä¶&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;modes-de-d√©clenchement&quot;&gt;Modes de d√©clenchement&lt;/h2&gt;

&lt;p&gt;Si on regarde de plus pr√®s les exigences techniques li√©es aux cas d‚Äôutilisation, on pourrait r√©sumer les diff√©rents modes de d√©clenchement de la mani√®re suivante:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Traitement sur r√©ception de fichiers&lt;/li&gt;
  &lt;li&gt;Traitement d√©clench√© par un ordonnanceur/orchestrateur centralis√© (ex. https://dkron.io/) de mani√®re r√©guli√®re ou non.&lt;/li&gt;
  &lt;li&gt;Traitement d√©clench√© par &lt;a href=&quot;https://en.wikipedia.org/wiki/Cron&quot;&gt;CRON&lt;/a&gt; (qui est un ordonnanceur, mais un peu plus roots)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;J‚Äôai volontairement exclu les traitements sur pr√©sence de messages (ex. Kafka). Je les consid√®re plus li√©s au monde transactionnel.&lt;/p&gt;

&lt;p&gt;Dans les paragraphes suivants, je vais d√©crire des solutions d‚Äôarchitecture qui permettent de d√©ployer ces traitements dans Kubernetes. J‚Äôaborderai sans doute un exemple dans un autre article&lt;/p&gt;

&lt;h2 id=&quot;contraintes&quot;&gt;Contraintes&lt;/h2&gt;

&lt;p&gt;D√®s qu‚Äôon s‚Äôaventure dans ce type de conception, nous aurons, au-del√† des &lt;a href=&quot;https://12factor.net/&quot;&gt;12 factors&lt;/a&gt;, les contraintes suivantes √† traiter:&lt;/p&gt;

&lt;h3 id=&quot;gestion-des-erreurs-et-indisponibilit√©s&quot;&gt;Gestion des erreurs et indisponibilit√©s&lt;/h3&gt;
&lt;p&gt;Dans un cluster Kubernetes, le crash d‚Äôun POD n‚Äôest pas r√©dhibitoire.
Le cluster permet de red√©marrer imm√©diatement une autre instance.&lt;/p&gt;

&lt;p&gt;Pour les APIs, ce n‚Äôest pas un probl√®me.
Pour les batchs, c‚Äôest une autre paire de manches. 
Quid du crash en plein milieu du traitement d‚Äôun fichier?&lt;/p&gt;

&lt;p&gt;Il faut donc penser √† ce cas (et √† d‚Äôautres) et archiver les fichiers pour un √©ventuel rejeu.&lt;/p&gt;

&lt;h3 id=&quot;donn√©es-et-idempotence-des-traitements&quot;&gt;Donn√©es et idempotence des traitements&lt;/h3&gt;

&lt;p&gt;Id√©alement, les fichiers doivent avoir des lignes ind√©pendantes qui peuvent √™tre ins√©r√©es individuellement et dans n‚Äôimporte quel ordre.
Aussi, chaque modification et traitement de donn√©es doivent √™tre idempotentes.&lt;/p&gt;

&lt;p&gt;Pourquoi? Pas seulement par ce que c‚Äôest sympa et l‚Äô√©tat de l‚Äôart, mais dans ce nouvel environnement, vous ne pourrez pas forc√©ment garantir l‚Äôordre des traitements.
L‚Äôune des solutions potentielles de traitement est de d√©coupler la lecture et l‚Äôinsertion par du queueing (Artemis, Kafka &lt;em&gt;- oui ce n‚Äôest pas du queuing, mais vous avez compris‚Ä¶&lt;/em&gt;). 
Dans ce cas, si votre traitement n‚Äôest pas idempotent, vous devrez lutter avec des doublons en base.&lt;/p&gt;

&lt;h3 id=&quot;gestion-des-ressources&quot;&gt;Gestion des ressources&lt;/h3&gt;

&lt;p&gt;Imaginez, vous recevez un fichier de 1Go. 
Vos ressources syst√®mes sont des PODs avec un 1 Go de RAM.&lt;/p&gt;

&lt;p&gt;Vous voyez le soucis?&lt;/p&gt;

&lt;p&gt;Cet exemple, qui n‚Äôest pas trop √©loign√© de la r√©alit√©, mets en √©vidence l‚Äôune des contraintes techniques que vous devrez prendre d√®s le d√©but de votre conception.&lt;/p&gt;

&lt;p&gt;L‚Äôune des solutions serait, par exemple, le traitement quasi syst√©matique du streaming de fichiers et l‚Äôobligation d‚Äôavoir des fichiers avec des lignes de donn√©es ind√©pendantes (c.-√†-d. sans avoir √† faire de liens inter lignes pendant le traitement).&lt;/p&gt;

&lt;h2 id=&quot;traitement-sur-r√©ception-de-fichiers&quot;&gt;Traitement sur r√©ception de fichiers&lt;/h2&gt;

&lt;p&gt;Dans ce cas, nous avons un processus qui est d√©clench√© lors de la r√©ception d‚Äôun fichier. Nous pourrons par exemple avec ce genre d‚Äôarchitecture un fichier qui est envoy√© dans espace de stockage objet. Ce dernier est ensuite trait√© par un programme.
J‚Äôai fait le choix ici de mettre en oeuvre un couplage l√¢che (on ne se refait pas) entre l‚Äôespace de r√©ception de fichiers et le traitement.&lt;/p&gt;

&lt;p&gt;Je traite ici le risque de crash d‚Äôun POD en gardant syst√©matiquement les fichiers dans un stockage objet. De cette mani√®re, si le traitement a √©chou√©, un autre POD pourra le t√©l√©charger et rejouer le processus batch.&lt;/p&gt;

&lt;p&gt;Ce d√©couplage permet de g√©rer facilement la scalabilit√© et les arr√™ts/relances de PODs.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/05/batch_evenement-Batch_sur_presence_fichier.svg&quot; alt=&quot;batch_evenement-Batch_sur_presence_fichier&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dans ce cas, le batch pourra √™tre d√©ploy√© sous la forme d‚Äôun &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&quot;&gt;d√©ploiement Kubernetes&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;traitement-d√©clench√©-√†-distance-par-ex-par-un-orchestrateur-de-traitements&quot;&gt;Traitement d√©clench√© √† distance (par ex. par un orchestrateur de traitements)&lt;/h2&gt;

&lt;p&gt;Maintenant, on va aborder les traitements qui sont lanc√©s par un ordonnanceur tiers ou tout simplement lanc√© √† distance. 
G√©n√©ralement, dans le monde de l‚Äôentreprise, la planification des traitements est centralis√©e au lieu de laisser de le faire sur chaque machine avec des &lt;a href=&quot;https://en.wikipedia.org/wiki/Cron&quot;&gt;CRON Jobs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Dans ce cas, on a deux mani√®res de proc√©der:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Avoir un traitement qui fournit une API permettant de d√©marrer des traitements et d‚Äôavoir leurs statuts.&lt;/li&gt;
  &lt;li&gt;Lancer des jobs.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;avec-une-api&quot;&gt;Avec une API&lt;/h3&gt;

&lt;p&gt;Ici, on con√ßoit les batchs comme des WEBAPPS qui fournissent des traitements batchs sur demande via des APIs. La contrainte est qu‚Äô√† l‚Äôinstar de la solution pr√©c√©dente, le programme tourne toujours et n‚Äôest vraiment utile que lorsqu‚Äôil est appel√© via un endpoint REST.&lt;/p&gt;

&lt;p&gt;Ce mod√®le de conception peut √™tre utilis√© √† mon avis si la fr√©quence est forte et si l‚Äôint√©gration d‚Äôun Job Kubernetes est probl√©matique pour vous (voir ci-dessous).&lt;/p&gt;

&lt;p&gt;L‚Äôun des avantages que l‚Äôon pourra trouver est que le &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/deployment/&quot;&gt;mode de d√©ploiement est assez simple et similaire aux APIs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2022/05/traitement_api.svg&quot; alt=&quot;traitement_api&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;avec-des-jobs&quot;&gt;Avec des jobs&lt;/h3&gt;

&lt;p&gt;Si votre ordonnanceur peut ex√©cuter le client kubectl, vous pourrez consid√©rer les &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/job/&quot;&gt;jobs  kubernetes&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;En r√©sum√©, ils permettent de cr√©er un POD et ex√©cute une action en g√©rant les erreurs potentielles jusqu‚Äô√† compl√©tion du traitement.&lt;/p&gt;

&lt;p&gt;Par exemple, voici un job permettant de faire un ‚ÄúHello World!‚Äù:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;batch/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Job&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello-world&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;helloworld&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;busybox&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;echo&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;World!&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Never&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Une fois d√©ploy√© avec Helm, vous pouvez les voir avec la commande &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kubectl get jobs&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;minikube kubectl &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; get &lt;span class=&quot;nb&quot;&gt;jobs
&lt;/span&gt;NAME          COMPLETIONS   DURATION   AGE
hello-world   0/1           25s        25s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pour les logs et voir le r√©sultat de la commande lanc√©, cela se passe d‚Äôune mani√®re assez habituelle:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;minikube kubectl &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; logs hello-world-zx4wh
Hello World!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;traitement-d√©clench√©-par-cron&quot;&gt;Traitement d√©clench√© par CRON&lt;/h2&gt;

&lt;p&gt;Maintenant, on va laisser le soin au Cluster Kubernetes de lancer les diff√©rents traitements via une CRON.
Bien que je ne suis pas trop fan de ne pas centraliser l‚Äôordonnancement, cela peut √™tre tr√®s utile si votre plateforme est centr√©e sur Kubernetes.&lt;/p&gt;

&lt;p&gt;Si vous √™tes dans ce cas-l√†, vous pouvez utiliser l‚Äôobjet &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/&quot;&gt;CronJob&lt;/a&gt; qui n‚Äôest ni plus ni moins qu‚Äôun &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/controllers/job/&quot;&gt;Job&lt;/a&gt; ex√©cut√© de mani√®re p√©riodique.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;batch/v1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;CronJob&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;hello&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;*&quot;&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;jobTemplate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;helloworld-cron&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;busybox&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;echo&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Hello&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;World!&quot;&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;OnFailure&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;panorama-des-solutions-logicielles-possibles&quot;&gt;Panorama des solutions logicielles possibles&lt;/h2&gt;

&lt;p&gt;Une fois qu‚Äôon s‚Äôest pos√© toutes (en tout cas certaines) les questions possibles sur nos exigences techniques et la conception, on peut voir quelles sont les technologies possibles pour impl√©menter des batchs ‚Äúcloud natifs‚Äù.&lt;/p&gt;

&lt;p&gt;√áa ne sera pas une surprise, je vais m‚Äôattarder √† la plateforme Java. Il est bien √©videmment possible d‚Äôutiliser d‚Äôautres langages et frameworks tels que Go.&lt;/p&gt;

&lt;p&gt;En Java, vous avez le choix entre diff√©rents frameworks :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;[Spring avec spring batch et/ou integration&quot;&gt;Spring avec spring batch&lt;/a&gt; et/ou &lt;a href=&quot;https://spring.io/projects/spring-integration&quot;&gt;integration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://camel.apache.org/&quot;&gt;Camel&lt;/a&gt; qui peut √™tre utilis√© avec &lt;a href=&quot;https://camel.apache.org/manual/spring.html&quot;&gt;Spring&lt;/a&gt; ou &lt;a href=&quot;https://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt; avec la &lt;a href=&quot;https://github.com/quarkiverse/quarkus-jberet&quot;&gt;JSR 352&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Si vous allez du c√¥t√© du BigData, vous pouvez aussi envisager d‚Äôutiliser des technologies telles qu‚Äô&lt;a href=&quot;https://spark.apache.org/&quot;&gt;Apache Spark&lt;/a&gt;.
Ces derni√®res vous permettront de &lt;a href=&quot;https://spark.apache.org/docs/latest/running-on-kubernetes.html&quot;&gt;d√©couper ‚Äúplus facilement‚Äù vos traitements&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;le-diable-se-cache-dans-les-d√©tails&quot;&gt;Le diable se cache dans les d√©tails&lt;/h2&gt;

&lt;p&gt;D√©ployer un batch dans Kubernetes peut se faire assez facilement (en d√©veloppement) une fois qu‚Äôon a compris quelques principes. 
Cependant, les soucis peuvent survenir une fois arriv√© en production.&lt;/p&gt;

&lt;p&gt;La gestion des erreurs est beaucoup plus complexe que les APIs. Il vous faudra donc d√©finir avec les diff√©rentes parties prenantes quel est le meilleur fonctionnement (rejeu) en production. 
Il vous faudra ainsi bien &lt;a href=&quot;https://blog.touret.info/2022/02/09/analyser-les-risques-pour-mieux-definir-une-architecture/&quot;&gt;identifier et √©valuer les risques li√©s √† votre application&lt;/a&gt; et voir quelles sont les actions √† mener.&lt;/p&gt;

&lt;p&gt;Aussi, si vous devez manipuler des fichiers volumineux, il faudra faire attention au syst√®me de fichiers utilis√© et ses performances. Habituellement, avec ce type d‚Äôarchitecture, on utilise g√©n√©ralement du SAN. En fonction de vos exigences, un &lt;a href=&quot;https://www.redhat.com/fr/topics/data-storage/file-block-object-storage&quot;&gt;stockage block&lt;/a&gt; pourra √™tre plus adapt√©.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Pour conclure cet article, vous aurez compris que le sujet des batchs dans Kubernetes peut s‚Äôav√©rer assez complexe √† g√©rer. 
Au-del√† des technologies qui peuvent faire le job (&lt;em&gt;d√©sol√© du mauvais jeu de mots&lt;/em&gt;), il vous faudra faire tr√®s attention √† tout l‚Äôenvironnement dans lequel votre programme devra interagir. Les bases, le r√©seau, les performances de votre mat√©riel seront des pr√©requis indispensables.&lt;/p&gt;

&lt;p&gt;Aussi, il vous faudra faire attention √† la mani√®re dont sont transmises les donn√©es et dont vous les traitez. 
Bref, il faut √©tudier la solution dans son ensemble du d√©veloppement √† l‚Äôexploitation pour s‚Äôassurer de ne rien oublier.&lt;/p&gt;

&lt;p&gt;Enfin, cet article n‚Äôest bien √©videmment pas exhaustif que cela soit sur les solutions ou les contraintes √† adresser. 
J‚Äôai n√©anmoins essay√© d‚Äôapporter quelques cas concrets et retours d‚Äôexp√©rience.&lt;/p&gt;

&lt;p&gt;J‚Äôessaierai de d√©tailler un cas concret dans un prochain article.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="cloud" /><category term="kubernetes" /><category term="batch" /><summary type="html">Quand on parle du Cloud et de Kubernetes, g√©n√©ralement on pense aux APIs. Mais qu‚Äôen est-il des batchs?</summary></entry><entry><title type="html">K8S, HELM et Cie: au del√† de la hype</title><link href="https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype/" rel="alternate" type="text/html" title="K8S, HELM et Cie: au del√† de la hype" /><published>2020-10-08T08:09:59+00:00</published><updated>2020-10-08T08:09:59+00:00</updated><id>https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype</id><content type="html" xml:base="https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype/">&lt;p&gt;Depuis quelques ann√©es, &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; (K8S) et &lt;a href=&quot;https://www.cncf.io/&quot;&gt;son √©cosyst√®me&lt;/a&gt; deviennent l‚Äôenvironnement d‚Äô ex√©cution √† la mode. Certaines personnes veulent d√©ployer sur cet environnement en mettant en avant ses capacit√©s de scalabilit√©. D‚Äôautres font du bashing (souvent) justifi√© sur la complexit√© et le co√ªt de mise en ≈ìuvre d‚Äôune telle plateforme.&lt;br /&gt;
Vous l‚Äôaurez compris, cette technologie n‚Äô√©chappe pas &lt;a href=&quot;https://fr.wikipedia.org/wiki/Cycle_du_hype&quot;&gt;au cycle du hype&lt;/a&gt; et √† la fameuse courbe du Gartner.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/10/gartner_hype_cycle.svg_.png&quot; alt=&quot;cycle hype&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Apr√®s quelques exp√©riences sur cette plateforme ( et beaucoup sur d‚Äôautres üòÄ ) je vais essayer de peser le pour et le contre qui m‚Äôapparaissent importants.&lt;br /&gt;
Bien √©videmment, ce n‚Äôest que mon avis, j‚Äôai sans doute omis certaines informations qui pourraient √™tre indispensables pour d‚Äô autres.&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-et-dans-quelles-conditions-il-ne-faut-pas-utiliser-k8s-&quot;&gt;Pourquoi et dans quelles conditions il ne faut pas utiliser K8S ?&lt;/h2&gt;

&lt;p&gt;Avant de pr√©senter les avantages des applications cloud, je vais essayer de r√©aliser l‚Äôanti th√®se de mon propos.&lt;/p&gt;

&lt;h3 id=&quot;en-avez-vous-vraiment-besoin-&quot;&gt;En avez vous (vraiment) besoin ?&lt;/h3&gt;

&lt;p&gt;Vaste sujet et question d√©licate pour la population informaticienne qui a tendance √† suivre les tendances du march√©.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/10/aaron-blanco-tejedor-vbe9zj-jhbs-unsplash.png&quot; alt=&quot;cycle hype&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Avant de foncer t√™te baiss√©e dans cette technologie qui est tr√®s int√©ressante au demeurant, il est important de se poser ces quelques questions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Est-ce que mes &lt;a href=&quot;https://fr.wikipedia.org/wiki/Service-level_objectives&quot;&gt;SLO&lt;/a&gt; sont contraignantes?&lt;/li&gt;
  &lt;li&gt;Quel le cycle de d√©ploiement de mes applications?&lt;/li&gt;
  &lt;li&gt;Qui g√®re les environnements ?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Bref, il faut savoir si le jeu en vaut la chandelle. Si vous avez une application qui doit scaler dynamiquement, encaisser les pics, et avoir du &lt;a href=&quot;https://dzone.com/articles/zero-downtime-deployment&quot;&gt;zero downtime durant les mises √† jour&lt;/a&gt;, Kubernetes est fait pour vous. Si vous avez une application de gestion qui n‚Äôa pas d‚Äôexigences fortes si ce n‚Äôest de r√©pondre aux besoins fonctionnels, l‚Äôutilisation de Kubernetes est discutable.&lt;/p&gt;

&lt;h3 id=&quot;√™tes-vous-taill√©-pour-&quot;&gt;√ätes vous taill√© pour ?&lt;/h3&gt;

&lt;p&gt;Kubernetes et son √©cosyst√®me peuvent s‚Äôav√©rer complexes √† appr√©hender. Si votre entreprise opte pour une utilisation ¬´¬†&lt;a href=&quot;https://en.wikipedia.org/wiki/On-premises_software&quot;&gt;on premise&lt;/a&gt;¬´¬†, c‚Äôest pire. Vous devrez avoir une √©quipe d√©di√©e qui g√©rera cette plateforme et offrir une expertise aux √©quipes de d√©veloppement.&lt;br /&gt;
Ne vous trompez pas. Si votre r√¥le est de d√©velopper des applications m√©tier, il vous sera tr√®s difficile d‚Äôavoir √©galement une expertise sur l‚Äôadministration de cette plateforme. Vous pourrez l‚Äôutiliser et √™tre √† l‚Äôaise, mais l‚Äôadministration d‚Äôune telle technologie est tr√®s compliqu√©e.&lt;/p&gt;

&lt;p&gt;Le seul conseil que je pourrais vous donner, c‚Äôest de ne partir sur Kubernetes que si vous avez une &lt;strong&gt;√©quipe support √† disposition&lt;/strong&gt;. C‚Äôest vrai si vous utilisez des services du Cloud tels que Google Cloud ou AWS. √áa l‚Äôest encore plus si vous utilisez des services ¬´¬†on premise¬†¬ª tels qu‚Äô Openshift.&lt;/p&gt;

&lt;h3 id=&quot;est-ce-que-vos-d√©veloppements-sont-cloud-native-&quot;&gt;Est-ce que vos d√©veloppements sont &lt;a href=&quot;https://www.redhat.com/fr/topics/cloud-native-apps&quot;&gt;¬´¬†cloud native¬†¬ª&lt;/a&gt; ?&lt;/h3&gt;

&lt;p&gt;Au del√† de la plateforme, vous devrez monter en comp√©tence sur le d√©veloppement et la conception de vos applications.&lt;/p&gt;

&lt;p&gt;Il vous faudra prendre en consid√©ration &lt;a href=&quot;https://en.wikipedia.org/wiki/Twelve-Factor_App_methodology&quot;&gt;les 12 facteurs cl√©s&lt;/a&gt; dans vos applications. Il n‚Äôest pas forc√©ment la peine de passer sur des microservices. Il est √©galement possible de faire des monolithes modulaires qui peuvent √™tre l√©gers et stateless. Beaucoup de ces facteurs sont commun√©ment admis comme des bonnes pratiques de d√©veloppement logiciel (ex. Il faut une int√©gration continue).&lt;/p&gt;

&lt;p&gt;Aussi, cela va sans dire, il faut √©galement monter (r√©ellement) en comp√©tence sur les conteneurs et leurs contraintes. Si vous n‚Äôavez pas l‚Äôhabitude de travailler avec des conteneurs ( construction, d√©ploiement, disponibilit√© d‚Äôune &lt;a href=&quot;https://docs.docker.com/registry/&quot;&gt;registry&lt;/a&gt;). Il est pr√©f√©rable de d√©finir une trajectoire avec des √©tapes interm√©diaires.&lt;/p&gt;

&lt;p&gt;Bref, tous ces sujets doivent √™tre adress√©s et compris pour toutes les parties prenantes de vos √©quipes que √ßa soit les d√©veloppeurs, les chefs de projet et les √©quipes m√©tiers √† une moindre mesure. Cette technologie repr√©sente r√©ellement un grand pas √† franchir. Si vous ne vous sentez pas de le faire, ou si vous devez gagner en maturit√© sur ces sujets, attendez avant de vous lancer sur Kubernetes.&lt;/p&gt;

&lt;p&gt;On ne pourra jamais vous reprocher de ne pas opter sur Kubernetes si vous ne remplissez pas tous les pr√©-requis. Pour ce qui est du contraire‚Ä¶&lt;/p&gt;

&lt;h3 id=&quot;avez-vous-des-interactions-avec-des-services-tiers-qui-sont-compatible-avec-kubernetes-&quot;&gt;Avez vous des interactions avec des services tiers qui sont compatible avec Kubernetes ?&lt;/h3&gt;

&lt;p&gt;Quand vous restez dans votre cluster Kubernetes, g√©n√©ralement, tout va bien. D√®s que vous avez des interactions avec des services tiers, √ßa peut se compliquer.&lt;br /&gt;
En effet, g√©n√©ralement vous devrez vous connecter √† des services tiers qui ne sont pas orient√© cloud : &lt;a href=&quot;https://en.wikipedia.org/wiki/Hardware_security_module&quot;&gt;des boitiers crypto&lt;/a&gt;, des passerelles de transfert, ‚Ä¶&lt;br /&gt;
Il se peut que certains protocoles soient √©galement incompatibles avec Kubernetes. Il vous faudra vous assurer que tout la galaxie de logiciels et syst√®mes gravitant autour de votre application sera compatible avec une telle architecture. Ceci n‚Äôest pas une mince affaire. L‚Äôaide d‚Äôune √©quipe support (voir ci-dessus) vous sera d‚Äôune grande utilit√©.&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-sauter-le-pas-&quot;&gt;Pourquoi sauter le pas ?&lt;/h2&gt;

&lt;h3 id=&quot;la-scalabilit√©-et-la-r√©sistance-√†-la-panne&quot;&gt;La scalabilit√© et la r√©sistance √† la panne&lt;/h3&gt;

&lt;p&gt;Personnellement, la premi√®re fonctionnalit√© qui m‚Äôa int√©ress√© c‚Äôest la gestion de la scalabilit√©. Si vous avez des objectifs de 99.9% de disponibilit√©. Kubernetes sera une plus value ind√©niable dans votre architecture. Apr√®s quelques &lt;s&gt;jours&lt;/s&gt; heures √† batailler avec les fichiers YAML, vous pourrez g√©rer automatiquement la scalabilit√© en fonction de plusieurs indicateurs qu‚Äôils soient techniques (ce sont les plus faciles √† g√©rer) ou un peu plus m√©tier &lt;a href=&quot;https://www.metricfire.com/blog/prometheus-metrics-based-autoscaling-in-kubernetes/&quot;&gt;en utilisant Prometheus&lt;/a&gt; ‚Äì et oui encore une technologie suppl√©mentaire √† conna√Ætre.&lt;/p&gt;

&lt;p&gt;En effet, au lieu de vous en soucier une fois arriv√© en production, vous aurez lors du d√©veloppement l‚Äôobligation de prendre en consid√©ration l‚Äôobservabilit√© de votre application. Par exemple, vous aurez √† renseigner &lt;a href=&quot;https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/&quot;&gt;si votre application est pr√™te et/ou disponible pour traiter les requ√™tes&lt;/a&gt;. Ces indicateurs vous permettront de scaler &lt;strong&gt;automatiquement&lt;/strong&gt; et de re-cr√©er si n√©cessaire un &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/pods/&quot;&gt;POD&lt;/a&gt; en cas de panne.&lt;/p&gt;

&lt;p&gt;J‚Äôai trouv√© que cette pratique √©tait vertueuse. Bien √©videmment, pas besoin d‚Äô√™tre sur Kubernetes pour avoir de l‚Äôobservabilit√© dans des applications. Par contre, ici, c‚Äôest obligatoire et impl√©ment√© d√®s le d√©veloppement.&lt;/p&gt;

&lt;p&gt;La scalabilit√© automatique est aussi tr√®s int√©ressante. On a souvent vu des serveurs en production qui n‚Äô√©taient pas suffisamment utilis√©s. Ici vous n‚Äôaurez que les instances n√©cessaires pour votre cas d‚Äôutilisation.&lt;br /&gt;
La contrainte que l‚Äôon peut voir √† cette fonctionnalit√© et qu‚Äôon ne maitrise pas compl√®tement le nombre d‚Äôinstances disponibles. C‚Äôest Kubernetes qui s‚Äôen charge en prenant en compte le param√©trage que vous aurez renseign√© dans vos &lt;a href=&quot;https://helm.sh/docs/chart_best_practices/templates/&quot;&gt;templates HELM&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;le-d√©ploiement&quot;&gt;Le d√©ploiement&lt;/h3&gt;

&lt;p&gt;Avant de d√©ployer (dans la vraie vie), vous aurez √† mettre en place un pipeline CI/CD qui orchestre les diff√©rents d√©ploiements sur tous vos environnements. Attention, ce n‚Äôest pas une mince affaire üôÇ !&lt;/p&gt;

&lt;p&gt;Une fois r√©alis√©, vous verrez automatiquement le gain. Vos d√©ploiements seront r√©ellement fluides. Bon OK, on peut le faire sur des &lt;a href=&quot;https://en.wikipedia.org/wiki/Virtual_machine&quot;&gt;VMS&lt;/a&gt; standards. Mais on peut am√©liorer la proc√©dure de d√©ploiement pour mettre en place du &lt;a href=&quot;https://dzone.com/articles/zero-downtime-deployment&quot;&gt;zero downtime&lt;/a&gt; pour ne pas interrompre le service lors d‚Äôun d√©ploiement.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;RollingUpdate&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;maxSurge&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;maxUnavailable&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;linfrastructure-as-code&quot;&gt;L‚ÄôInfrastructure As Code&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png&quot; alt=&quot;iaac&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Quand on pense √† Kubernetes, et au cloud, on ne pense pas trop √† l‚Äô&lt;a href=&quot;https://en.wikipedia.org/wiki/Infrastructure_as_code&quot;&gt;Infrastructure As Code&lt;/a&gt; au d√©but. Cependant, cette pratique est pour moi l‚Äôune des plus utiles.&lt;/p&gt;

&lt;p&gt;En effet, avoir votre syst√®me d√©crit dans des fichiers, versionn√©s vous permet de le tester d√®s le d√©veloppement. √áa √©vite ( dans la majorit√© des cas ) les erreurs lors des installations d‚Äôenvironnement. La mise √† jour des logiciels est largement acc√©l√©r√©e.&lt;/p&gt;

&lt;p&gt;Bien √©videmment, il existe &lt;a href=&quot;https://www.terraform.io/&quot;&gt;Terraform&lt;/a&gt; et &lt;a href=&quot;https://www.ansible.com/&quot;&gt;Ansible&lt;/a&gt; pour le provisionning des environnements. Ici je trouve qu‚Äôon pousse le concept encore plus loin. L‚Äôautomatisation est √† mon avis pouss√© √† paroxysme.&lt;br /&gt;
Prenons par exemple la gestion des syst√®mes d‚Äôexploitation. La mise √† jour sur des serveurs physiques ou virtuels peut prendre √©norm√©ment de temps et g√©n√©rer des erreurs. Avec de l‚Äôinfra as code, ceci est test√© et valid√© automatiquement via des tests unitaires d√®s l‚Äôenvironnement de d√©veloppement.&lt;br /&gt;
On peut suivre la gestion des environnements via un gestionnaire de sources et la promotion vers les autres environnements (recette[1-n], pr√©-production, production) est grandement acc√©l√©r√©e.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Bon, vous l‚Äôaurez peut √™tre compris, cette galaxie de technologies est int√©ressante et peut vous aider dans vos projets. Avant d‚Äôarriver √† l‚Äôutiliser sereinement, il vous faudra sans doute d√©finir une trajectoire et appr√©hender plusieurs sujets avant d‚Äôarriver √† d√©ployer vos applications sur un cloud interne ou externe.&lt;br /&gt;
J‚Äôesp√®re que cet article vous aura permis de mettre en √©vidence les pour et contre d‚Äôune telle technologie et le cas √©ch√©ant vous donnera envie de franchir le pas.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="helm" /><category term="hype" /><category term="k8s" /><category term="kubernetes" /><summary type="html">Depuis quelques ann√©es, Kubernetes (K8S) et son √©cosyst√®me deviennent l‚Äôenvironnement d‚Äô ex√©cution √† la mode. Certaines personnes veulent d√©ployer sur cet environnement en mettant en avant ses capacit√©s de scalabilit√©. D‚Äôautres font du bashing (souvent) justifi√© sur la complexit√© et le co√ªt de mise en ≈ìuvre d‚Äôune telle plateforme. Vous l‚Äôaurez compris, cette technologie n‚Äô√©chappe pas au cycle du hype et √† la fameuse courbe du Gartner.</summary></entry><entry><title type="html">Utiliser des GITHUB Actions pour d√©ployer dans Google Kubernetes Engine</title><link href="https://blog.touret.info/2020/05/10/utiliser-des-github-actions-pour-deployer-dans-google-kubernetes-engine/" rel="alternate" type="text/html" title="Utiliser des GITHUB Actions pour d√©ployer dans Google Kubernetes Engine" /><published>2020-05-10T06:22:00+00:00</published><updated>2020-05-10T06:22:00+00:00</updated><id>https://blog.touret.info/2020/05/10/utiliser-des-github-actions-pour-deployer-dans-google-kubernetes-engine</id><content type="html" xml:base="https://blog.touret.info/2020/05/10/utiliser-des-github-actions-pour-deployer-dans-google-kubernetes-engine/">&lt;p&gt;A mes heures perdues, je travaille sur un ¬´¬†POC/side project qui n‚Äôaboutira pas et je m‚Äôen fiche¬†¬ª bas√© sur Quarkus. J‚Äô ai choisi d‚Äôutiliser les langages et composants suivants :&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://kotlinlang.org/&quot;&gt;Kotlin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gradle.org/&quot;&gt;Gradle&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; pour le d√©ploiement&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Oui, tant qu‚Äô√† faire, autant aller dans la hype ‚Ä¶&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/05/article_github_actions_k8s-1.png&quot; alt=&quot;boot&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/alexandre-touret/music-quote&quot;&gt;Mon projet est sur GITHUB&lt;/a&gt;. Pour automatiser certaines actions et, disons-le, par fiert√© personnelle, j‚Äôai choisi d‚Äôautomatiser certaines actions par la mise en ≈ìuvre de pipelines CI/CD.&lt;br /&gt;
Depuis peu, GITHUB a int√©gr√© un m√©canisme de pipeline : &lt;a href=&quot;https://github.com/features/actions&quot;&gt;GITHUB Actions&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;√áa permet, entre autres, de lancer des processus automatis√© sur un push ou sur une action pour un commit GIT.&lt;/p&gt;

&lt;p&gt;La force de l‚Äôoutil est, selon moi, de facilement s‚Äôint√©grer avec beaucoup de services du cloud ( sonarcloud, google cloud, heroku,‚Ä¶). On aime ou on n‚Äôaime pas, mais chez Microsoft, l‚Äôint√©gration ils savent faire.&lt;/p&gt;

&lt;p&gt;Par exemple, si on veut lancer une compilation lors d‚Äôun push, on peut placer un fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.github/workflows/build.xml&lt;/code&gt; avec le contenu :&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;CI&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/checkout@v1&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Set up JDK &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/setup-java@v1&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;java-version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Build with Gradle without testing&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;./gradlew build -x test&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cot√© GITHUB, vous verrez l‚Äôex√©cution sur un √©cran d√©di√©&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/05/screenshot_2020-05-08-alexandre-touret-music-quote.png&quot; alt=&quot;boot&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Vous pouvez cr√©er autant de workflows que vous souhaitez (si votre projet est en libre acc√®s).&lt;br /&gt;
Pour chaque workflow, on peut d√©finir et utiliser des jobs. Les logs d‚Äôex√©cution sont disponibles dans ce m√™me √©cran:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/05/screenshot_2020-05-09-alexandre-touret-music-quote.png&quot; alt=&quot;workflow&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;worflows-impl√©ment√©s&quot;&gt;Worflows impl√©ment√©s&lt;/h2&gt;

&lt;p&gt;J‚Äôai choisi d‚Äôimpl√©menter les workflows suivants:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;CI&lt;/strong&gt;: Build sur la feature branch&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CD&lt;/strong&gt;: Build sur master branch et d√©ploiement&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;On obtient donc dans mon cas:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/05/workflow.png&quot; alt=&quot;workflow&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Ce n‚Äôest pas parfait. Loin de l√†. Dans la ¬´¬†vraie vie¬†¬ª, pour une √©quipe de dev, je l‚Äôam√©liorerai sans doute par un build docker dans les features branches, une validation formelle et bloquante de l‚Äôanalyse sonar, etc.&lt;br /&gt;
Pour un dev perso √ßa suffit largement. Le contenu de la branche master est compil√© et une image docker est cr√©e pour √™tre d√©ploy√©e automatiquement dans GKE.&lt;/p&gt;

&lt;h2 id=&quot;analyse-sonar&quot;&gt;Analyse SONAR&lt;/h2&gt;

&lt;p&gt;J‚Äôai choisi d‚Äôutiliser &lt;a href=&quot;http://sonarcloud.io/&quot;&gt;sonarcloud&lt;/a&gt; pour analyser mon code. C‚Äôest gratuit pour les projets opensource. L‚Äôanalyse se fait simplement:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;sonarCloudTrigger&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;SonarCloud Trigger&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/checkout@v1&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Set up JDK &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/setup-java@v1&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;java-version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;SonarCloud Scan&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;GITHUB_TOKEN&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;SONAR_TOKEN&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;./gradlew jacocoTestReport sonarqube&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Dans ce job j‚Äôutilise deux &lt;a href=&quot;https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets&quot;&gt;secrets&lt;/a&gt;. Ce sont des tokens qui permettent de ne pas stocker en dur les donn√©es dans les repos GITHUB.&lt;/p&gt;

&lt;h2 id=&quot;cr√©ation-dune-image-docker-et-d√©ploiement-dans-le-registry-github&quot;&gt;Cr√©ation d‚Äôune image Docker et d√©ploiement dans le registry GITHUB&lt;/h2&gt;

&lt;p&gt;Ici aussi, √ßa se fait simplement. La preuve :&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;ubuntu-latest&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/checkout@v1&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Set up JDK &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;actions/setup-java@v1&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;java-version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Build in JVM Mode with Gradle without testing&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;./gradlew quarkusBuild  [1]&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Branch name&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;echo running on branch ${GITHUB_REF##*/}&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Build the Docker image Quarkus JVM&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker build -f src/main/docker/Dockerfile.jvm -t docker.pkg.github.com/${GITHUB_REPOSITORY}/music-quote-jvm:latest .  [2]&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Login against github docker repository&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;GITHUB_TOKEN&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker login -u ${GITHUB_ACTOR} -p ${GITHUB_TOKEN}  docker.pkg.github.com   [3]&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Publish the Docker image Quarkus JVM&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;docker push docker.pkg.github.com/${GITHUB_REPOSITORY}/music-quote-jvm:latest  [4]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;Cr√©ation du binaire&lt;/li&gt;
  &lt;li&gt;Cr√©ation de l‚Äôimage docker en utilisant la commande docker et le Dockerfile fourni par Quarkus&lt;/li&gt;
  &lt;li&gt;Identification sur la registry Docker de GITHUB&lt;/li&gt;
  &lt;li&gt;D√©ploiement de l‚Äôimage&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Pour plus de d√©tails sur la variable GITHUB_TOKEN, vous pouvez lire &lt;a href=&quot;https://help.github.com/en/actions/configuring-and-managing-workflows/authenticating-with-the-github_token&quot;&gt;cet article de la documentation&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;d√©ploiement-dans-google-kubernetes-engine&quot;&gt;D√©ploiement dans Google Kubernetes Engine&lt;/h2&gt;

&lt;p&gt;Mon application est pour l‚Äôinstant architectur√©e comme suit (&lt;em&gt;attention c‚Äôest compliqu√©&lt;/em&gt;):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/05/application-1.png&quot; alt=&quot;workflow&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pour la d√©ployer dans Google Kubernetes Engine, j‚Äôai besoin d‚Äô impl√©menter cette ¬´¬†architecture¬†¬ª par les objets Kubernetes suivants:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/2020/05/application_gke.png&quot; alt=&quot;workflow&quot; class=&quot;align-center&quot; /&gt;&lt;/p&gt;

&lt;p&gt;J‚Äôutilise les objets suivants:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Des services pour exposer la base de donn√©es ainsi que l‚Äôapplication&lt;/li&gt;
  &lt;li&gt;Un deployment pour l‚Äôapplication&lt;/li&gt;
  &lt;li&gt;Des pods car √† un moment, il en faut‚Ä¶&lt;/li&gt;
  &lt;li&gt;Un statefulset pour la base de donn√©es&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Vous pourrez trouver la d√©finition de tous ces objets au format yaml via &lt;a href=&quot;https://github.com/alexandre-touret/music-quote/tree/master/k8s&quot;&gt;ce lien&lt;/a&gt;. J‚Äôai fait tr√®s simple. Logiquement j‚Äôaurai du cr√©er un volume pour les bases de donn√©es ou utiliser une base de donn√©es en mode PAAS.&lt;/p&gt;

&lt;p&gt;Pour lancer le d√©ploiement, il faut au pr√©alable cr√©er un secret ( fait manuellement pour ne pas stocker d‚Äôobjet yaml dans le repository GITHUB) pour se connecter au repo GITHUB via la commande suivante:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kubectl create secret docker-registry github-registry &lt;span class=&quot;nt&quot;&gt;--docker-server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;docker.pkg.github.com &lt;span class=&quot;nt&quot;&gt;--docker-username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;USER--docker-password&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;PASSWORD &lt;span class=&quot;nt&quot;&gt;--docker-email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;EMAIL
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On peut faire pareil pour les connexions base de donn√©es. J‚Äôai mis dans un configmap pour ne pas trop me prendre la t√™te‚Ä¶&lt;/p&gt;

&lt;p&gt;Apr√®s le d√©ploiement via le pipeline se fait assez simplement:&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;pi&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;GoogleCloudPlatform/github-actions/setup-gcloud@master&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;286.0.0'&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;service_account_email&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;service_account_key&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;project_id&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;$&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Get the GKE credentials so we can deploy to the cluster&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;|-&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;gcloud container clusters get-credentials &quot;$&quot; --zone &quot;$&quot;&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;# Deploy the Docker image to the GKE cluster&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Deploy&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pi&quot;&gt;|-&lt;/span&gt;
          &lt;span class=&quot;s&quot;&gt;kubectl apply -f ./k8s     &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;J‚Äôutilise &lt;a href=&quot;https://github.com/GoogleCloudPlatform/github-actions&quot;&gt;les ¬´¬†actions¬†¬ª fournies par Google&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Pour que √ßa marche il y a pas mal d‚Äô√©tapes pr√©alables ( des tokens √† g√©n√©rer, un utilisateur technique, ‚Ä¶).&lt;br /&gt;
J‚Äôai essay√© de les r√©f√©rencer dans &lt;a href=&quot;https://github.com/alexandre-touret/music-quote&quot;&gt;le README du projet&lt;/a&gt;.&lt;br /&gt;
Si vous voulez tester l‚Äôint√©gration Kubernetes dans le cloud google, sachez que vous pouvez disposer d‚Äôun cr√©dit de 300‚Ç¨ valable un an. Attention, avec ce genre d‚Äôarchitecture, √ßa part vite‚Ä¶&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="github" /><category term="gradle" /><category term="kubernetes" /><summary type="html">A mes heures perdues, je travaille sur un ¬´¬†POC/side project qui n‚Äôaboutira pas et je m‚Äôen fiche¬†¬ª bas√© sur Quarkus. J‚Äô ai choisi d‚Äôutiliser les langages et composants suivants :</summary></entry></feed>