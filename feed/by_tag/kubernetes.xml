<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="https://blog.touret.info/feed/by_tag/kubernetes.xml" rel="self" type="application/atom+xml" /><link href="https://blog.touret.info/" rel="alternate" type="text/html" /><updated>2021-12-15T21:09:47+00:00</updated><id>https://blog.touret.info/feed/by_tag/kubernetes.xml</id><title type="html">blog.touret.info</title><subtitle>Mon blog personnel. J'y expose mes derniers travaux et ma veille technologique. Au menu en vrac: Java, Kotlin, Maven, Docker, Cloud, Kubernetes, logiciels libres, Debian, Ubuntu, Gnu/Linux, des talks online et prÃ©sentiels.</subtitle><author><name>Alexandre Touret</name></author><entry><title type="html">K8S, HELM et Cie: au delÃ  de la hype</title><link href="https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype/" rel="alternate" type="text/html" title="K8S, HELM et Cie: au delÃ  de la hype" /><published>2020-10-08T08:09:59+00:00</published><updated>2020-10-08T08:09:59+00:00</updated><id>https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype</id><content type="html" xml:base="https://blog.touret.info/2020/10/08/k8s-helm-et-cie-au-dela-de-la-hype/">&lt;p&gt;Depuis quelques annÃ©es, &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; (K8S) et &lt;a href=&quot;https://www.cncf.io/&quot;&gt;son Ã©cosystÃ¨me&lt;/a&gt; deviennent lâ€™environnement dâ€™ exÃ©cution Ã  la mode. Certaines personnes veulent dÃ©ployer sur cet environnement en mettant en avant ses capacitÃ©s de scalabilitÃ©. Dâ€™autres font du bashing (souvent) justifiÃ© sur la complexitÃ© et le coÃ»t de mise en Å“uvre dâ€™une telle plateforme.&lt;br /&gt;
Vous lâ€™aurez compris, cette technologie nâ€™Ã©chappe pas &lt;a href=&quot;https://fr.wikipedia.org/wiki/Cycle_du_hype&quot;&gt;au cycle du hype&lt;/a&gt; et Ã  la fameuse courbe du Gartner.&lt;/p&gt;

&lt;div class=&quot;wp-block-image&quot;&gt;
  &lt;figure class=&quot;aligncenter size-large&quot;&gt;&lt;img loading=&quot;lazy&quot; width=&quot;320&quot; height=&quot;208&quot; src=&quot;/assets/images/2020/10/gartner_hype_cycle.svg_.png?w=320&quot; alt=&quot;&quot; class=&quot;wp-image-445&quot; srcset=&quot;/assets/images/2020/10/gartner_hype_cycle.svg_.png 320w, /assets/images/2020/10/gartner_hype_cycle.svg_-300x195.png 300w&quot; sizes=&quot;(max-width: 320px) 100vw, 320px&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;AprÃ¨s quelques expÃ©riences sur cette plateforme ( et beaucoup sur dâ€™autres ğŸ˜€ ) je vais essayer de peser le pour et le contre qui mâ€™apparaissent importants.&lt;br /&gt;
Bien Ã©videmment, ce nâ€™est que mon avis, jâ€™ai sans doute omis certaines informations qui pourraient Ãªtre indispensables pour dâ€™ autres.&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-et-dans-quelles-conditions-il-ne-faut-pas-utiliser-k8s-&quot;&gt;Pourquoi et dans quelles conditions il ne faut pas utiliser K8S ?&lt;/h2&gt;

&lt;p&gt;Avant de prÃ©senter les avantages des applications cloud, je vais essayer de rÃ©aliser lâ€™anti thÃ¨se de mon propos.&lt;/p&gt;

&lt;h3 id=&quot;en-avez-vous-vraiment-besoin-&quot;&gt;En avez vous (vraiment) besoin ?&lt;/h3&gt;

&lt;p&gt;Vaste sujet et question dÃ©licate pour la population informaticienne qui a tendance Ã  suivre les tendances du marchÃ©.&lt;/p&gt;

&lt;div class=&quot;wp-block-image&quot;&gt;
  &lt;figure class=&quot;aligncenter size-large is-resized&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;/assets/images/2020/10/aaron-blanco-tejedor-vbe9zj-jhbs-unsplash.png?w=986&quot; alt=&quot;&quot; class=&quot;wp-image-464&quot; width=&quot;611&quot; height=&quot;404&quot; srcset=&quot;/assets/images/2020/10/aaron-blanco-tejedor-vbe9zj-jhbs-unsplash.png 986w, /assets/images/2020/10/aaron-blanco-tejedor-vbe9zj-jhbs-unsplash-300x199.png 300w, /assets/images/2020/10/aaron-blanco-tejedor-vbe9zj-jhbs-unsplash-768x509.png 768w&quot; sizes=&quot;(max-width: 611px) 100vw, 611px&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Avant de foncer tÃªte baissÃ©e dans cette technologie qui est trÃ¨s intÃ©ressante au demeurant, il est important de se poser ces quelques questions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Est-ce que mes &lt;a href=&quot;https://fr.wikipedia.org/wiki/Service-level_objectives&quot;&gt;SLO&lt;/a&gt; sont contraignantes?&lt;/li&gt;
  &lt;li&gt;Quel le cycle de dÃ©ploiement de mes applications?&lt;/li&gt;
  &lt;li&gt;Qui gÃ¨re les environnements ?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Bref, il faut savoir si le jeu en vaut la chandelle. Si vous avez une application qui doit scaler dynamiquement, encaisser les pics, et avoir du &lt;a href=&quot;https://dzone.com/articles/zero-downtime-deployment&quot;&gt;zero downtime durant les mises Ã  jour&lt;/a&gt;, Kubernetes est fait pour vous. Si vous avez une application de gestion qui nâ€™a pas dâ€™exigences fortes si ce nâ€™est de rÃ©pondre aux besoins fonctionnels, lâ€™utilisation de Kubernetes est discutable.&lt;/p&gt;

&lt;h3 id=&quot;Ãªtes-vous-taillÃ©-pour-&quot;&gt;ÃŠtes vous taillÃ© pour ?&lt;/h3&gt;

&lt;p&gt;Kubernetes et son Ã©cosystÃ¨me peuvent sâ€™avÃ©rer complexes Ã  apprÃ©hender. Si votre entreprise opte pour une utilisation Â«Â &lt;a href=&quot;https://en.wikipedia.org/wiki/On-premises_software&quot;&gt;on premise&lt;/a&gt;Â«Â , câ€™est pire. Vous devrez avoir une Ã©quipe dÃ©diÃ©e qui gÃ©rera cette plateforme et offrir une expertise aux Ã©quipes de dÃ©veloppement.&lt;br /&gt;
Ne vous trompez pas. Si votre rÃ´le est de dÃ©velopper des applications mÃ©tier, il vous sera trÃ¨s difficile dâ€™avoir Ã©galement une expertise sur lâ€™administration de cette plateforme. Vous pourrez lâ€™utiliser et Ãªtre Ã  lâ€™aise, mais lâ€™administration dâ€™une telle technologie est trÃ¨s compliquÃ©e.&lt;/p&gt;

&lt;p&gt;Le seul conseil que je pourrais vous donner, câ€™est de ne partir sur Kubernetes que si vous avez une &lt;strong&gt;Ã©quipe support Ã  disposition&lt;/strong&gt;. Câ€™est vrai si vous utilisez des services du Cloud tels que Google Cloud ou AWS. Ã‡a lâ€™est encore plus si vous utilisez des services Â«Â on premiseÂ Â» tels quâ€™ Openshift.&lt;/p&gt;

&lt;h3 id=&quot;est-ce-que-vos-dÃ©veloppements-sont-cloud-native-&quot;&gt;Est-ce que vos dÃ©veloppements sont &lt;a href=&quot;https://www.redhat.com/fr/topics/cloud-native-apps&quot;&gt;Â«Â cloud nativeÂ Â»&lt;/a&gt; ?&lt;/h3&gt;

&lt;p&gt;Au delÃ  de la plateforme, vous devrez monter en compÃ©tence sur le dÃ©veloppement et la conception de vos applications.&lt;/p&gt;

&lt;p&gt;Il vous faudra prendre en considÃ©ration &lt;a href=&quot;https://en.wikipedia.org/wiki/Twelve-Factor_App_methodology&quot;&gt;les 12 facteurs clÃ©s&lt;/a&gt; dans vos applications. Il nâ€™est pas forcÃ©ment la peine de passer sur des microservices. Il est Ã©galement possible de faire des monolithes modulaires qui peuvent Ãªtre lÃ©gers et stateless. Beaucoup de ces facteurs sont communÃ©ment admis comme des bonnes pratiques de dÃ©veloppement logiciel (ex. Il faut une intÃ©gration continue).&lt;/p&gt;

&lt;p&gt;Aussi, cela va sans dire, il faut Ã©galement monter (rÃ©ellement) en compÃ©tence sur les conteneurs et leurs contraintes. Si vous nâ€™avez pas lâ€™habitude de travailler avec des conteneurs ( construction, dÃ©ploiement, disponibilitÃ© dâ€™une &lt;a href=&quot;https://docs.docker.com/registry/&quot;&gt;registry&lt;/a&gt;). Il est prÃ©fÃ©rable de dÃ©finir une trajectoire avec des Ã©tapes intermÃ©diaires.&lt;/p&gt;

&lt;p&gt;Bref, tous ces sujets doivent Ãªtre adressÃ©s et compris pour toutes les parties prenantes de vos Ã©quipes que Ã§a soit les dÃ©veloppeurs, les chefs de projet et les Ã©quipes mÃ©tiers Ã  une moindre mesure. Cette technologie reprÃ©sente rÃ©ellement un grand pas Ã  franchir. Si vous ne vous sentez pas de le faire, ou si vous devez gagner en maturitÃ© sur ces sujets, attendez avant de vous lancer sur Kubernetes.&lt;/p&gt;

&lt;p&gt;On ne pourra jamais vous reprocher de ne pas opter sur Kubernetes si vous ne remplissez pas tous les prÃ©-requis. Pour ce qui est du contraireâ€¦&lt;/p&gt;

&lt;h3 id=&quot;avez-vous-des-interactions-avec-des-services-tiers-qui-sont-compatible-avec-kubernetes-&quot;&gt;Avez vous des interactions avec des services tiers qui sont compatible avec Kubernetes ?&lt;/h3&gt;

&lt;p&gt;Quand vous restez dans votre cluster Kubernetes, gÃ©nÃ©ralement, tout va bien. DÃ¨s que vous avez des interactions avec des services tiers, Ã§a peut se compliquer.&lt;br /&gt;
En effet, gÃ©nÃ©ralement vous devrez vous connecter Ã  des services tiers qui ne sont pas orientÃ© cloud : &lt;a href=&quot;https://en.wikipedia.org/wiki/Hardware_security_module&quot;&gt;des boitiers crypto&lt;/a&gt;, des passerelles de transfert, â€¦&lt;br /&gt;
Il se peut que certains protocoles soient Ã©galement incompatibles avec Kubernetes. Il vous faudra vous assurer que tout la galaxie de logiciels et systÃ¨mes gravitant autour de votre application sera compatible avec une telle architecture. Ceci nâ€™est pas une mince affaire. Lâ€™aide dâ€™une Ã©quipe support (voir ci-dessus) vous sera dâ€™une grande utilitÃ©.&lt;/p&gt;

&lt;h2 id=&quot;pourquoi-sauter-le-pas-&quot;&gt;Pourquoi sauter le pas ?&lt;/h2&gt;

&lt;h3 id=&quot;la-scalabilitÃ©-et-la-rÃ©sistance-Ã -la-panne&quot;&gt;La scalabilitÃ© et la rÃ©sistance Ã  la panne&lt;/h3&gt;

&lt;p&gt;Personnellement, la premiÃ¨re fonctionnalitÃ© qui mâ€™a intÃ©ressÃ© câ€™est la gestion de la scalabilitÃ©. Si vous avez des objectifs de 99.9% de disponibilitÃ©. Kubernetes sera une plus value indÃ©niable dans votre architecture. AprÃ¨s quelques &lt;s&gt;jours&lt;/s&gt; heures Ã  batailler avec les fichiers YAML, vous pourrez gÃ©rer automatiquement la scalabilitÃ© en fonction de plusieurs indicateurs quâ€™ils soient techniques (ce sont les plus faciles Ã  gÃ©rer) ou un peu plus mÃ©tier &lt;a href=&quot;https://www.metricfire.com/blog/prometheus-metrics-based-autoscaling-in-kubernetes/&quot;&gt;en utilisant Prometheus&lt;/a&gt; â€“ et oui encore une technologie supplÃ©mentaire Ã  connaÃ®tre.&lt;/p&gt;

&lt;p&gt;En effet, au lieu de vous en soucier une fois arrivÃ© en production, vous aurez lors du dÃ©veloppement lâ€™obligation de prendre en considÃ©ration lâ€™observabilitÃ© de votre application. Par exemple, vous aurez Ã  renseigner &lt;a href=&quot;https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/&quot;&gt;si votre application est prÃªte et/ou disponible pour traiter les requÃªtes&lt;/a&gt;. Ces indicateurs vous permettront de scaler &lt;strong&gt;automatiquement&lt;/strong&gt; et de re-crÃ©er si nÃ©cessaire un &lt;a href=&quot;https://kubernetes.io/docs/concepts/workloads/pods/&quot;&gt;POD&lt;/a&gt; en cas de panne.&lt;/p&gt;

&lt;p&gt;Jâ€™ai trouvÃ© que cette pratique Ã©tait vertueuse. Bien Ã©videmment, pas besoin dâ€™Ãªtre sur Kubernetes pour avoir de lâ€™observabilitÃ© dans des applications. Par contre, ici, câ€™est obligatoire et implÃ©mentÃ© dÃ¨s le dÃ©veloppement.&lt;/p&gt;

&lt;p&gt;La scalabilitÃ© automatique est aussi trÃ¨s intÃ©ressante. On a souvent vu des serveurs en production qui nâ€™Ã©taient pas suffisamment utilisÃ©s. Ici vous nâ€™aurez que les instances nÃ©cessaires pour votre cas dâ€™utilisation.&lt;br /&gt;
La contrainte que lâ€™on peut voir Ã  cette fonctionnalitÃ© et quâ€™on ne maitrise pas complÃ¨tement le nombre dâ€™instances disponibles. Câ€™est Kubernetes qui sâ€™en charge en prenant en compte le paramÃ©trage que vous aurez renseignÃ© dans vos &lt;a href=&quot;https://helm.sh/docs/chart_best_practices/templates/&quot;&gt;templates HELM&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;le-dÃ©ploiement&quot;&gt;Le dÃ©ploiement&lt;/h3&gt;

&lt;p&gt;Avant de dÃ©ployer (dans la vraie vie), vous aurez Ã  mettre en place un pipeline CI/CD qui orchestre les diffÃ©rents dÃ©ploiements sur tous vos environnements. Attention, ce nâ€™est pas une mince affaire ğŸ™‚ !&lt;/p&gt;

&lt;p&gt;Une fois rÃ©alisÃ©, vous verrez automatiquement le gain. Vos dÃ©ploiements seront rÃ©ellement fluides. Bon OK, on peut le faire sur des &lt;a href=&quot;https://en.wikipedia.org/wiki/Virtual_machine&quot;&gt;VMS&lt;/a&gt; standards. Mais on peut amÃ©liorer la procÃ©dure de dÃ©ploiement pour mettre en place du &lt;a href=&quot;https://dzone.com/articles/zero-downtime-deployment&quot;&gt;zero downtime&lt;/a&gt; pour ne pas interrompre le service lors dâ€™un dÃ©ploiement.&lt;/p&gt;

&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;RollingUpdate&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;maxSurge&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;maxUnavailable&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;linfrastructure-as-code&quot;&gt;Lâ€™Infrastructure As Code&lt;/h3&gt;

&lt;div class=&quot;wp-block-image&quot;&gt;
  &lt;figure class=&quot;aligncenter size-large is-resized&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;/assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png?w=683&quot; alt=&quot;&quot; class=&quot;wp-image-462&quot; width=&quot;452&quot; height=&quot;678&quot; srcset=&quot;/assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash.png 719w, /assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash-200x300.png 200w, /assets/images/2020/10/jacek-dylag-nhcpop4a2xo-unsplash-683x1024.png 683w&quot; sizes=&quot;(max-width: 452px) 100vw, 452px&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Quand on pense Ã  Kubernetes, et au cloud, on ne pense pas trop Ã  lâ€™&lt;a href=&quot;https://en.wikipedia.org/wiki/Infrastructure_as_code&quot;&gt;Infrastructure As Code&lt;/a&gt; au dÃ©but. Cependant, cette pratique est pour moi lâ€™une des plus utiles.&lt;/p&gt;

&lt;p&gt;En effet, avoir votre systÃ¨me dÃ©crit dans des fichiers, versionnÃ©s vous permet de le tester dÃ¨s le dÃ©veloppement. Ã‡a Ã©vite ( dans la majoritÃ© des cas ) les erreurs lors des installations dâ€™environnement. La mise Ã  jour des logiciels est largement accÃ©lÃ©rÃ©e.&lt;/p&gt;

&lt;p&gt;Bien Ã©videmment, il existe &lt;a href=&quot;https://www.terraform.io/&quot;&gt;Terraform&lt;/a&gt; et &lt;a href=&quot;https://www.ansible.com/&quot;&gt;Ansible&lt;/a&gt; pour le provisionning des environnements. Ici je trouve quâ€™on pousse le concept encore plus loin. Lâ€™automatisation est Ã  mon avis poussÃ© Ã  paroxysme.&lt;br /&gt;
Prenons par exemple la gestion des systÃ¨mes dâ€™exploitation. La mise Ã  jour sur des serveurs physiques ou virtuels peut prendre Ã©normÃ©ment de temps et gÃ©nÃ©rer des erreurs. Avec de lâ€™infra as code, ceci est testÃ© et validÃ© automatiquement via des tests unitaires dÃ¨s lâ€™environnement de dÃ©veloppement.&lt;br /&gt;
On peut suivre la gestion des environnements via un gestionnaire de sources et la promotion vers les autres environnements (recette[1-n], prÃ©-production, production) est grandement accÃ©lÃ©rÃ©e.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Bon, vous lâ€™aurez peut Ãªtre compris, cette galaxie de technologies est intÃ©ressante et peut vous aider dans vos projets. Avant dâ€™arriver Ã  lâ€™utiliser sereinement, il vous faudra sans doute dÃ©finir une trajectoire et apprÃ©hender plusieurs sujets avant dâ€™arriver Ã  dÃ©ployer vos applications sur un cloud interne ou externe.&lt;br /&gt;
Jâ€™espÃ¨re que cet article vous aura permis de mettre en Ã©vidence les pour et contre dâ€™une telle technologie et le cas Ã©chÃ©ant vous donnera envie de franchir le pas.&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="helm" /><category term="hype" /><category term="k8s" /><category term="kubernetes" /><summary type="html">Depuis quelques annÃ©es, Kubernetes (K8S) et son Ã©cosystÃ¨me deviennent lâ€™environnement dâ€™ exÃ©cution Ã  la mode. Certaines personnes veulent dÃ©ployer sur cet environnement en mettant en avant ses capacitÃ©s de scalabilitÃ©. Dâ€™autres font du bashing (souvent) justifiÃ© sur la complexitÃ© et le coÃ»t de mise en Å“uvre dâ€™une telle plateforme. Vous lâ€™aurez compris, cette technologie nâ€™Ã©chappe pas au cycle du hype et Ã  la fameuse courbe du Gartner.</summary></entry><entry><title type="html">Utiliser des GITHUB Actions pour dÃ©ployer dans Google Kubernetes Engine</title><link href="https://blog.touret.info/2020/05/10/utiliser-des-github-actions-pour-deployer-dans-google-kubernetes-engine/" rel="alternate" type="text/html" title="Utiliser des GITHUB Actions pour dÃ©ployer dans Google Kubernetes Engine" /><published>2020-05-10T06:22:00+00:00</published><updated>2020-05-10T06:22:00+00:00</updated><id>https://blog.touret.info/2020/05/10/utiliser-des-github-actions-pour-deployer-dans-google-kubernetes-engine</id><content type="html" xml:base="https://blog.touret.info/2020/05/10/utiliser-des-github-actions-pour-deployer-dans-google-kubernetes-engine/">&lt;p class=&quot;has-drop-cap&quot;&gt;
  A mes heures perdues, je travaille sur un Â«Â &lt;em&gt;POC/side project qui n&amp;rsquo;aboutira pas et je m&amp;rsquo;en fiche&lt;/em&gt;Â Â» basÃ© sur Quarkus. J&amp;rsquo; ai choisi d&amp;rsquo;utiliser les langages et composants suivants :
&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://kotlinlang.org/&quot;&gt;Kotlin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://quarkus.io/&quot;&gt;Quarkus&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gradle.org/&quot;&gt;Gradle&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; pour le dÃ©ploiement&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Oui, tant quâ€™Ã  faire, autant aller dans la hype â€¦&lt;/p&gt;

&lt;div class=&quot;wp-block-group&quot;&gt;
  &lt;div class=&quot;wp-block-group__inner-container&quot;&gt;
    &lt;div class=&quot;wp-block-image&quot;&gt;
      &lt;figure class=&quot;aligncenter size-medium&quot;&gt;&lt;img loading=&quot;lazy&quot; width=&quot;696&quot; height=&quot;549&quot; src=&quot;/assets/images/2020/05/article_github_actions_k8s-1.png?w=300&quot; alt=&quot;&quot; class=&quot;wp-image-412&quot; srcset=&quot;/assets/images/2020/05/article_github_actions_k8s-1.png 696w, /assets/images/2020/05/article_github_actions_k8s-1-300x237.png 300w&quot; sizes=&quot;(max-width: 696px) 100vw, 696px&quot; /&gt;&lt;/figure&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/alexandre-touret/music-quote&quot;&gt;Mon projet est sur GITHUB&lt;/a&gt;. Pour automatiser certaines actions et, disons-le, par fiertÃ© personnelle, jâ€™ai choisi dâ€™automatiser certaines actions par la mise en Å“uvre de pipelines CI/CD.&lt;br /&gt;
Depuis peu, GITHUB a intÃ©grÃ© un mÃ©canisme de pipeline : &lt;a href=&quot;https://github.com/features/actions&quot;&gt;GITHUB Actions&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Ã‡a permet, entre autres, de lancer des processus automatisÃ© sur un push ou sur une action pour un commit GIT.&lt;/p&gt;

&lt;p&gt;La force de lâ€™outil est, selon moi, de facilement sâ€™intÃ©grer avec beaucoup de services du cloud ( sonarcloud, google cloud, heroku,â€¦). On aime ou on nâ€™aime pas, mais chez Microsoft, lâ€™intÃ©gration ils savent faire.&lt;/p&gt;

&lt;p&gt;Par exemple, si on veut lancer une compilation lors dâ€™un push, on peut placer un fichier &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.github/workflows/build.xml&lt;/code&gt; avec le contenu :&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CI&lt;/span&gt;

&lt;span class=&quot;nl&quot;&gt;on:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;nl&quot;&gt;jobs:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;build:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;runs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;on:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ubuntu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;steps:&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;checkout&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@v1&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JDK&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@v1&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;with:&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;version:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Build&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Gradle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;without&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;./&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gradlew&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;build&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;test&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;CotÃ© GITHUB, vous verrez lâ€™exÃ©cution sur un Ã©cran dÃ©diÃ©&lt;figure class=&quot;wp-block-image size-large is-resized&quot;&gt;&lt;/figure&gt;&lt;/p&gt;

&lt;p&gt;&lt;img loading=&quot;lazy&quot; src=&quot;/assets/images/2020/05/screenshot_2020-05-08-alexandre-touret-music-quote.png?w=1024&quot; alt=&quot;&quot; class=&quot;wp-image-376&quot; width=&quot;768&quot; height=&quot;305&quot; srcset=&quot;/assets/images/2020/05/screenshot_2020-05-08-alexandre-touret-music-quote.png 1025w, /assets/images/2020/05/screenshot_2020-05-08-alexandre-touret-music-quote-300x119.png 300w, /assets/images/2020/05/screenshot_2020-05-08-alexandre-touret-music-quote-768x306.png 768w&quot; sizes=&quot;(max-width: 768px) 100vw, 768px&quot; /&gt; &amp;lt;/figure&amp;gt;&lt;/p&gt;

&lt;p&gt;Vous pouvez crÃ©er autant de workflows que vous souhaitez (si votre projet est en libre accÃ¨s).&lt;br /&gt;
Pour chaque workflow, on peut dÃ©finir et utiliser des jobs. Les logs dâ€™exÃ©cution sont disponibles dans ce mÃªme Ã©cran:&lt;/p&gt;

&lt;div class=&quot;wp-block-image&quot;&gt;
  &lt;figure class=&quot;aligncenter size-large is-resized&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;/assets/images/2020/05/screenshot_2020-05-09-alexandre-touret-music-quote.png?w=936&quot; alt=&quot;&quot; class=&quot;wp-image-399&quot; width=&quot;702&quot; height=&quot;275&quot; srcset=&quot;/assets/images/2020/05/screenshot_2020-05-09-alexandre-touret-music-quote.png 936w, /assets/images/2020/05/screenshot_2020-05-09-alexandre-touret-music-quote-300x117.png 300w, /assets/images/2020/05/screenshot_2020-05-09-alexandre-touret-music-quote-768x300.png 768w&quot; sizes=&quot;(max-width: 702px) 100vw, 702px&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;worflows-implÃ©mentÃ©s&quot;&gt;Worflows implÃ©mentÃ©s&lt;/h2&gt;

&lt;p&gt;Jâ€™ai choisi dâ€™implÃ©menter les workflows suivants:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;CI&lt;/strong&gt;: Build sur la feature branch&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;CD&lt;/strong&gt;: Build sur master branch et dÃ©ploiement&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;On obtient donc dans mon cas:&lt;/p&gt;

&lt;div class=&quot;wp-block-image&quot;&gt;
  &lt;figure class=&quot;aligncenter size-large is-resized&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;/assets/images/2020/05/workflow.png?w=1024&quot; alt=&quot;&quot; class=&quot;wp-image-378&quot; width=&quot;512&quot; height=&quot;396&quot; srcset=&quot;/assets/images/2020/05/workflow.png 1056w, /assets/images/2020/05/workflow-300x232.png 300w, /assets/images/2020/05/workflow-1024x791.png 1024w, /assets/images/2020/05/workflow-768x593.png 768w&quot; sizes=&quot;(max-width: 512px) 100vw, 512px&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Ce nâ€™est pas parfait. Loin de lÃ . Dans la Â«Â vraie vieÂ Â», pour une Ã©quipe de dev, je lâ€™amÃ©liorerai sans doute par un build docker dans les features branches, une validation formelle et bloquante de lâ€™analyse sonar, etc.&lt;br /&gt;
Pour un dev perso Ã§a suffit largement. Le contenu de la branche master est compilÃ© et une image docker est crÃ©e pour Ãªtre dÃ©ployÃ©e automatiquement dans GKE.&lt;/p&gt;

&lt;h2 id=&quot;analyse-sonar&quot;&gt;Analyse SONAR&lt;/h2&gt;

&lt;p&gt;Jâ€™ai choisi dâ€™utiliser &lt;a href=&quot;http://sonarcloud.io/&quot;&gt;sonarcloud&lt;/a&gt; pour analyser mon code. Câ€™est gratuit pour les projets opensource. Lâ€™analyse se fait simplement:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;sonarCloudTrigger:&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SonarCloud&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Trigger&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;runs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;on:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ubuntu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;steps:&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;checkout&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@v1&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JDK&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@v1&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;with:&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;version:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SonarCloud&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Scan&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;env:&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;GITHUB_TOKEN:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;SONAR_TOKEN:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;./&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gradlew&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jacocoTestReport&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sonarqube&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Dans ce job jâ€™utilise deux &lt;a href=&quot;https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets&quot;&gt;secrets&lt;/a&gt;. Ce sont des tokens qui permettent de ne pas stocker en dur les donnÃ©es dans les repos GITHUB.&lt;/p&gt;

&lt;h2 id=&quot;crÃ©ation-dune-image-docker-et-dÃ©ploiement-dans-le-registry-github&quot;&gt;CrÃ©ation dâ€™une image Docker et dÃ©ploiement dans le registry GITHUB&lt;/h2&gt;

&lt;p&gt;Ici aussi, Ã§a se fait simplement. La preuve :&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nl&quot;&gt;jobs:&lt;/span&gt;
  &lt;span class=&quot;nl&quot;&gt;publish:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;runs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;on:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ubuntu&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;steps:&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;checkout&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@v1&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;up&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JDK&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@v1&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;with:&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;version:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Build&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JVM&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Mode&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Gradle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;without&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;testing&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;./&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gradlew&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quarkusBuild&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Branch&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;running&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;branch&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GITHUB_REF&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;##&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*/}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Build&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Quarkus&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JVM&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;build&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Dockerfile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;jvm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;github&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GITHUB_REPOSITORY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;music&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quote&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;jvm:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Login&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;against&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;github&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;repository&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;env:&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;GITHUB_TOKEN:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;login&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GITHUB_ACTOR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GITHUB_TOKEN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;github&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;com&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Publish&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Quarkus&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;JVM&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;github&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GITHUB_REPOSITORY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;music&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quote&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;jvm:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;CrÃ©ation du binaire&lt;/li&gt;
  &lt;li&gt;CrÃ©ation de lâ€™image docker en utilisant la commande docker et le Dockerfile fourni par Quarkus&lt;/li&gt;
  &lt;li&gt;Identification sur la registry Docker de GITHUB&lt;/li&gt;
  &lt;li&gt;DÃ©ploiement de lâ€™image&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Pour plus de dÃ©tails sur la variable GITHUB_TOKEN, vous pouvez lire &lt;a href=&quot;https://help.github.com/en/actions/configuring-and-managing-workflows/authenticating-with-the-github_token&quot;&gt;cet article de la documentation&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;dÃ©ploiement-dans-google-kubernetes-engine&quot;&gt;DÃ©ploiement dans Google Kubernetes Engine&lt;/h2&gt;

&lt;p&gt;Mon application est pour lâ€™instant architecturÃ©e comme suit (&lt;em&gt;attention câ€™est compliquÃ©&lt;/em&gt;):&lt;/p&gt;

&lt;div class=&quot;wp-block-columns&quot;&gt;
  &lt;div class=&quot;wp-block-column&quot; style=&quot;flex-basis:100%;&quot;&gt;
    &lt;div class=&quot;wp-block-image is-style-default&quot;&gt;
      &lt;figure class=&quot;aligncenter size-medium&quot;&gt;&lt;img loading=&quot;lazy&quot; width=&quot;359&quot; height=&quot;483&quot; src=&quot;/assets/images/2020/05/application-1.png?w=223&quot; alt=&quot;&quot; class=&quot;wp-image-391&quot; srcset=&quot;/assets/images/2020/05/application-1.png 359w, /assets/images/2020/05/application-1-223x300.png 223w&quot; sizes=&quot;(max-width: 359px) 100vw, 359px&quot; /&gt;&lt;/figure&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Pour la dÃ©ployer dans Google Kubernetes Engine, jâ€™ai besoin dâ€™ implÃ©menter cette Â«Â architectureÂ Â» par les objets Kubernetes suivants:&lt;/p&gt;

&lt;div class=&quot;wp-block-image&quot;&gt;
  &lt;figure class=&quot;aligncenter size-large is-resized&quot;&gt;&lt;img loading=&quot;lazy&quot; src=&quot;/assets/images/2020/05/application_gke.png?w=561&quot; alt=&quot;&quot; class=&quot;wp-image-392&quot; width=&quot;421&quot; height=&quot;443&quot; srcset=&quot;/assets/images/2020/05/application_gke.png 561w, /assets/images/2020/05/application_gke-285x300.png 285w&quot; sizes=&quot;(max-width: 421px) 100vw, 421px&quot; /&gt;&lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Jâ€™utilise les objets suivants:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Des services pour exposer la base de donnÃ©es ainsi que lâ€™application&lt;/li&gt;
  &lt;li&gt;Un deployment pour lâ€™application&lt;/li&gt;
  &lt;li&gt;Des pods car Ã  un moment, il en fautâ€¦&lt;/li&gt;
  &lt;li&gt;Un statefulset pour la base de donnÃ©es&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Vous pourrez trouver la dÃ©finition de tous ces objets au format yaml via &lt;a href=&quot;https://github.com/alexandre-touret/music-quote/tree/master/k8s&quot;&gt;ce lien&lt;/a&gt;. Jâ€™ai fait trÃ¨s simple. Logiquement jâ€™aurai du crÃ©er un volume pour les bases de donnÃ©es ou utiliser une base de donnÃ©es en mode PAAS.&lt;/p&gt;

&lt;p&gt;Pour lancer le dÃ©ploiement, il faut au prÃ©alable crÃ©er un secret ( fait manuellement pour ne pas stocker dâ€™objet yaml dans le repository GITHUB) pour se connecter au repo GITHUB via la commande suivante:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;kubectl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secret&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;github&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;github&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;com&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;PASSWORD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;EMAIL&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On peut faire pareil pour les connexions base de donnÃ©es. Jâ€™ai mis dans un configmap pour ne pas trop me prendre la tÃªteâ€¦&lt;/p&gt;

&lt;p&gt;AprÃ¨s le dÃ©ploiement via le pipeline se fait assez simplement:&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[...]&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;uses:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;GoogleCloudPlatform&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;github&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;actions&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gcloud&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@master&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;with:&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;version:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;286.0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;'&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;service_account_email:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;service_account_key:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
          &lt;span class=&quot;nl&quot;&gt;project_id:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
      &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;GKE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credentials&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;so&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;we&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;can&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deploy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|-&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;gcloud&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;container&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clusters&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;credentials&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;$&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zone&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;$&quot;&lt;/span&gt;
      &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Deploy&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Docker&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;GKE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Deploy&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;run:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|-&lt;/span&gt;
          &lt;span class=&quot;n&quot;&gt;kubectl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apply&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;./&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k8s&lt;/span&gt;     
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Jâ€™utilise &lt;a href=&quot;https://github.com/GoogleCloudPlatform/github-actions&quot;&gt;les Â«Â actionsÂ Â» fournies par Google&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Pour que Ã§a marche il y a pas mal dâ€™Ã©tapes prÃ©alables ( des tokens Ã  gÃ©nÃ©rer, un utilisateur technique, â€¦).&lt;br /&gt;
Jâ€™ai essayÃ© de les rÃ©fÃ©rencer dans &lt;a href=&quot;https://github.com/alexandre-touret/music-quote&quot;&gt;le README du projet&lt;/a&gt;.&lt;br /&gt;
Si vous voulez tester lâ€™intÃ©gration Kubernetes dans le cloud google, sachez que vous pouvez disposer dâ€™un crÃ©dit de 300â‚¬ valable un an. Attention, avec ce genre dâ€™architecture, Ã§a part viteâ€¦&lt;/p&gt;</content><author><name>Alexandre Touret</name></author><category term="github" /><category term="gradle" /><category term="kubernetes" /><summary type="html">A mes heures perdues, je travaille sur un Â«Â POC/side project qui n&amp;rsquo;aboutira pas et je m&amp;rsquo;en ficheÂ Â» basÃ© sur Quarkus. J&amp;rsquo; ai choisi d&amp;rsquo;utiliser les langages et composants suivants :</summary></entry></feed>